{"componentChunkName":"component---src-templates-course-content-template-js","path":"/osa-5/1-http-protokollan-tilattomuus-ja-evasteet","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Oppimistavoitteet"},"children":[{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tunnet käsitteen tilattomuus."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tiedät mitä evästeet ovat ja mihin niitä käytetään."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat luoda sovelluksen, joka käyttää evästeitä käyttäjän tunnistamiseen."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tunnet evästeisiin liittyviä oleellisia lakiteknisia asioita."}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"HTTP on tilaton protokolla. Tämä tarkoittaa sitä, että jokainen pyyntö on erillinen kokonaisuus, joka ei liity aiempiin pyyntöihin. Suunnittelupäätöksen taustalla oli ajatus siitä, että verkkosivulle ladattava sisältö voi sijaita useammalla eri palvelimella. Jos HTTP ottaisi kantaa käyttäjän tilaan, tulisi myös hajautettujen ratkaisujen tilan ylläpitoon ottaa kantaa — tämä olisi myös ollut melko tehotonta ("},{"type":"element","tagName":"a","properties":{"href":"https://www.w3.org/Protocols/HTTP/HTTP2.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Basic HTTP as defined in 1992"}]},{"type":"text","value":"). Päätös tilattomuudesta on ollut järkevä: suurin osa verkkoliikenteestä liittyy muuttumattoman sisällön hakemiseen, jolloin palvelinten ei tarvitse varata resursseja käyttäjän tilan ylläpitämiseen, eikä palvelinten ja selainohjelmistojen toteuttajien ole tarvinnut toteuttaa mekanismeja käyttäjien tilan ylläpitämiseen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käyttäjän tunnistamiseen pyyntöjen välillä on kuitenkin tarvetta. Esimerkiksi verkkokaupat ja muut käyttäjän kirjautumista vaativat palvelut tarvitsevat tavan käyttäjän tunnistamiseen. Klassinen — mutta huono — tapa käyttäjän tunnistamiseen on ollut säilyttää GET-muotoisessa osoitteessa parametreja, joiden perusteella asiakas voidaan tunnistaa palvelinsovelluksessa. Tämä ei kuitenkaan ole suositeltavaa, sillä osoitteessa olevia parametreja voi muokata käsin."}]},{"type":"element","tagName":"text-box","properties":{"variant":"hint","name":"Case: GET-parametri tunnistautumiseen"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Eräässä järjestelmässä — onneksi jo vuosia sitten — verkkokaupan toiminnallisuus oli toteutettu siten, että GET-parametrina säilytettiin numeerista ostoskorin identifioivaa tunnusta. Käyttäjäkohtaisuus oli toteutettu palvelinpuolella siten, että tietyllä GET-parametrilla näytettiin aina tietyn käyttäjän ostoskori. Uusien tuotteiden lisääminen ostoskoriin onnistui helposti, sillä pyynnöissä oli aina mukana ostoskorin tunnistava GET-parametri. Ostoskorit oli valitettavasti identifioitu juoksevalla numerosarjalla. Henkilöllä 1 oli ostoskori 1, henkilöllä 2 ostoskori 2 jne.."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Koska käytännössä kuka tahansa pääsi katsomaan kenen tahansa ostoskoria vain osoitteessa olevaa numeroa vaihtamalla, olivat ostoskorien sisällöt välillä hyvin mielenkiintoisia."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"HTTP-protokollan tilattomuus ei pakota palvelinohjelmistoja tilattomuuteen. Mikäli haluamme pitää kirjaa käyttäjistä, löytyy siihen erilaisia keinoja yllä mainitusta GET-parametrin käytöstä lähtien. Toistaiseksi yleisin tekniikka käyttäjän tilan ylläpitoon ja tunnistamiseen on HTTP-pyynnön mukana kulkevat evästeet."}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"HTTP ja evästeet"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Merkittävä osa verkkosovelluksista sisältää käyttäjäkohtaista toiminnallisuutta, jonka toteuttamiseen sovelluksella täytyy olla jonkinlainen tieto käyttäjästä sekä mahdollisesti käyttäjän tilasta. HTTP-protokollan versio 1.1 sekä uudemmat tarjoavat mahdollisuuden tilallisten verkkosovellusten toteuttamiseen evästeiden ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"cookies"}]},{"type":"text","value":") avulla."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Evästeet toteutetaan HTTP-protokollan otsakkeiden avulla. Kun käyttäjä tekee pyynnön palvelimelle, ja palvelimella halutaan asettaa käyttäjälle eväste, palautetaan vastauksen osana otsake "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Set-Cookie"}]},{"type":"text","value":", jossa määritellään käyttäjäkohtainen evästetunnus. Otsake voi olla esimerkiksi seuraavan näköinen:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Set-Cookie: fb1a1466ccceee22a0=0hr0aa2ogdfgkelogg; Max-Age=3600; Domain=\".helsinki.fi\""}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yllä oleva palvelimelta palautettu vastaus pyytää selainta tallettamaan evästeen. Kun selaimella on tiettyyn osoitteeseen liittyvä eväste tallennettuna, tulee sen jatkossa lisätä eväste "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"fb1a1466ccceee22a0=0hr0aa2ogdfgkelogg"}]},{"type":"text","value":" jokaiseen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helsinki.fi"}]},{"type":"text","value":"-osoitteeseen lähetettävään pyyntöön. Yllä eväste on voimassa tunnin, eli selain ja palvelin voi unohtaa sen tunnin kuluttua sen asettamisesta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tarkempi syntaksi evästeen asettamiselle on seuraava:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Set-Cookie: nimi=arvo [; Comment=kommentti] [; Max-Age=elinaika sekunteina]\n                    [; Expires=parasta ennen paiva] [; Path=polku tai polunosa jossa eväste voimassa]\n                    [; Domain=palvelimen osoite (URL) tai osoitteen osa jossa eväste voimassa]\n                    [; Secure (jos määritelty, eväste lähetetään vain salatun yhteyden kanssa)]\n                    [; Version=evästeen versio]"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Evästeet tallennetaan selaimen sisäiseen evästerekisteriin, josta niitä haetaan aina kun käyttäjä tekee selaimella kyselyn. Evästeet lähetetään palvelimelle jokaisen viestin yhteydessä "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Cookie"}]},{"type":"text","value":"-otsakkeessa."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Cookie: fb1a1466ccceee22a0=0hr0aa2ogdfgkelogg"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Evästeiden nimet ja arvot ovat yleensä monimutkaisia ja satunnaisesti luotuja niiden yksilöllisyyden takaamiseksi. Tällöin jokaisella käyttäjällä on oma uniikki eväste, jonka käyttäjä lähettää palvelimelle."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yleisesti ottaen evästeet ovat sekä hyödyllisiä että haitallisia: niiden avulla voidaan luoda yksiöityjä käyttökokemuksia tarjoavia sovelluksia ja esimerkiksi toteuttaa verkkokauppoja, mutta niitä voidaan käyttää myös käyttäjien seurantaan. Sovellusten kehittäjien pitää myös tiedostaa tämä — esimerkiksi Googlen ilmaiseksi tarjoama "},{"type":"element","tagName":"a","properties":{"href":"https://fi.wikipedia.org/wiki/Google_Analytics","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Google Analytics"}]},{"type":"text","value":"-palvelu, jota käytetään sivustojen kävijöiden seurantaan, kerää tietoa käyttäjistä. Mikäli tällaisia järjestelmiä käytetään arkaluonteisia tietoja sisältävillä sivuilla, voi käyttäjästä vuotaa yksityiseksi toivottuja tietoja ulkopuolisille tahoille. Tämä on näkynyt myös mediassa — lue "},{"type":"element","tagName":"a","properties":{"href":"https://www.hs.fi/teknologia/art-2000006041757.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Helsingin sanomien uutinen aiheesta"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"text-box","properties":{"variant":"hint","name":"Evästeet hs.fi -palvelussa"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Painamalla F12 tai valitsemalla Tools -> Developer tools, pääset tutkimaan sivun lataamiseen ja sisältöön liittyvää statistiikkaa. Lisäneuvoja löytyy "},{"type":"element","tagName":"a","properties":{"href":"https://developers.google.com/web/tools/chrome-devtools/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Google Developers"}]},{"type":"text","value":"-sivustolta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Avaa developer tools, ja mene osoitteeseen "},{"type":"element","tagName":"a","properties":{"href":"https://www.hs.fi","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://www.hs.fi"}]},{"type":"text","value":". Valitsemalla developer toolsien välilehden "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Application"}]},{"type":"text","value":", löydät valikon erilaisista sivuun liittyvistä resursseista. Etsi kohta "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Storage"}]},{"type":"text","value":" ja avaa sen alla oleva "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Cookies"}]},{"type":"text","value":"-kohta. Valitse vaihtoehto "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"https://www.hs.fi"}]},{"type":"text","value":". Kuinka monta eri evästettä selain lähettää tehdessäsi pyynnön osoitteeseen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"https://www.hs.fi"}]},{"type":"text","value":"?"}]}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Evästeet ja istunnot eli sessiot"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun selain lähettää palvelimelle pyynnön yhteydessä evästeen, palvelin etsii evästeen perusteella käynnissä olevaa istuntoa eli sessiota. Jos sessio löytyy, annetaan siihen liittyvät tiedot sovelluksen käyttöön käyttäjän pyynnön käsittelyä varten. Jos sessiota taas ei löydy, aloitetaan uusi sessio, johon liittyvä eväste palautetaan käyttäjälle vastauksen yhteydessä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Javassa sessioiden käsittelyyn löytyy "},{"type":"element","tagName":"a","properties":{"href":"https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"HttpSession"}]},{"type":"text","value":"-luokka, joka tarjoaa välineet sessio- ja käyttäjäkohtaisen tiedon tallentamiseen. Oleellisimmat luokan metodit ovat "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"public void setAttribute(String name, Object value)"}]},{"type":"text","value":", joka tallentaa sessioon arvon, sekä "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"public Object getAttribute(String name)"}]},{"type":"text","value":", jonka avulla kyseinen arvo löytyy."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"HttpSession-olion saa Springissä yksinkertaisimmillaan käyttöön lisäämällä sen kontrollerimetodin parametriksi. Tällöin Spring asettaa kyseiseen pyyntöön liittyvän session metodin parametriin automaattisesti. Alla on kuvattuna sovellus, joka pitää sessiokohtaista kirjaa käyttäjien tekemistä pyynnöistä."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","namespace"]},"children":[{"type":"text","value":"javax"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"servlet"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"http"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"HttpSession"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","namespace"]},"children":[{"type":"text","value":"org"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"springframework"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"stereotype"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Controller"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","namespace"]},"children":[{"type":"text","value":"org"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"springframework"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"web"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"bind"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"annotation"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","namespace"]},"children":[{"type":"text","value":"org"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"springframework"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"web"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"bind"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"annotation"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ResponseBody"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"VisitCountController"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"*\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ResponseBody"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"count"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"HttpSession"}]},{"type":"text","value":" session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" visits "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"count\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            visits "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"count\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n        visits"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"++"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"count\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" visits"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Visits: \""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" visits"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun käyttäjä tekee ensimmäistä kertaa pyynnön sovellukseen, palauttaa sovellus merkkijonon \"Visits: 1\". Vastauksen yhteydessä palautetaan myös eväste. Kun käyttäjä tekee seuraavan kerran pyynnön sovellukseen, lähettää selain pyynnön yhteydessä myös evästeen palvelimelle, jolloin palvelin osaa tunnistaa käyttäjän ja hakee oikean istunnon tiedot — vastaukseksi palautuu lopulta merkkijono \"Visits: 2\"."}]},{"type":"element","tagName":"programming-exercise","properties":{"name":"Hello Session","tmcname":"osa05-Osa05_01.HelloSession"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Toteuta sovellus, joka palauttaa käyttäjälle merkkijonon \"Hello there!\" jos käyttäjä ei ole ennen vieraillut sovelluksessa. Jos käyttäjä on vieraillut sovelluksessa aiemmin, tulee sovelluksen palauttaa käyttäjälle merkkijono \"Hello again!\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Palauta merkkijono ensimmäisestä osasta tutun annotaation "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@ResponseBody"}]},{"type":"text","value":" avulla."}]}]},{"type":"element","tagName":"text-box","properties":{"variant":"hint","name":"Evästeiden ja istuntojen testaaminen selaimella"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Istuntojen toiminnallisuuden testaaminen selaimella onnistuu näppärästi selainten tarjoaman anonyymitoiminnallisuuden avulla. Esimerkiksi Chromessa voi valita \"New incognito window\", mikä avaa käyttöön selainikkunan, missä ei aluksi ole lainkaan vanhoja evästeitä muistissa. Kun palvelimelle tehdään pyyntö, tallentuu vastauksen yhteydessä palautettava eväste selaimen muistiin vain siksi aikaa kun anonyymi-ikkuna on auki."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Session pituus riippuu esimerkiksi palvelimen asetuksista "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"session timeout"}]},{"type":"text","value":" ja siitä, että salliiko käyttäjä evästeiden käytön."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"HttpSession"}]},{"type":"text","value":"-olioon pääsee käsiksi myös muualla sovelluksessa ja sen voi injektoida esimerkiksi palveluun "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"-annotaation avulla. Edellinen kontrolleriin toteutettu toiminnallisuus voitaisiin tehdä myös palvelussa."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// importit"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CountService"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"HttpSession"}]},{"type":"text","value":" session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"incrementAndCount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"text","value":" count "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"count\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"!="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"null"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n            count "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"int"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"count\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n        count"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"++"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        session"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"count\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" count"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" count"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nyt kontrollerin koodi olisi kevyempi:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// importit"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"VisitCountController"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"CountService"}]},{"type":"text","value":" countService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"*\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@ResponseBody"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"count"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Visits: \""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" countService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"incrementAndCount"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"programming-exercise","properties":{"name":"Reload Heroes","tmcname":"osa05-Osa05_02.ReloadHeroes"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Reload Heroes -sovellus pitää kirjaa käyttäjän tekemistä sivun uudelleenlatauksista. Kun käyttäjä saapuu sovellukseen ensimmäistä kertaa, hänelle luodaan satunnainen käyttäjätunnus ja hänen vierailujen määrä asetetaan yhteen. Jokaisen uudelleenvierailun yhteydessä käyttäjän vierailujen määrä kasvaa yhdellä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Täydennä luokan "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ReloadController"}]},{"type":"text","value":" metodin reload toimintaa seuraavasti."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Metodin tulee palauttaa model-attribuuttina \"scores\" viisi eniten uudelleenlatauksia tehnyttä käyttäjää suuruusjärjestyksessä. Listan ensimmäisellä sijalla on eniten uudelleenlatauksia tehnyt henkilö, toisella sijalla toiseksi eniten jne."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Metodin tulee lisäksi palauttaa pyynnön tehneeseen henkilöön liittyvä "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ReloadStatus"}]},{"type":"text","value":"-olio modelin attribuuttina status. Jos käyttäjä ei ole tehnyt yhtäkään pyyntöä aiemmin, tulee käyttäjälle luoda uusi tunnus sekä alustaa uudelleenlatausten määrä yhteen. Jos taas käyttäjä on tehnyt pyyntöjä aiemmin, tulee käyttäjän tekemien pyyntöjen määrää kasvattaa yhdellä. Tieto pyyntöjen määrästä tulee myös tallentaa tietokantaan."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Voit testata sovelluksen toimintaa selaimen anonyymitilassa. Anonyymitilassa selain ei lähetä normaalitilassa kertyneitä evästeitä palvelimelle."}]}]},{"type":"element","tagName":"text-box","properties":{"variant":"hint","name":"Milloin sessioita kannattaa käyttää?"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Muutamia faktoja sessioista:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Sessio häviää kun käyttäjä poistaa selaimesta evästeet."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Sessio häviää kun evästeen elinikä kuluu loppuun."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Jokaisessa päätelaitteessa on tyypillisesti oma sessio: jos palvelua käytetään kännykällä ja padilla, kummallakin on omat evästeet. "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Tämä on nykyään muuttumassa, esimerkiksi jotkut Googlen tuotteet pitävät kirjaa evästeistä myös laitteiden yli."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Käyttäjä voi estää evästeiden käytön selaimen asetuksista."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sessioiden käyttö on näppärää sellaisen tiedon tallentamiseen mikä saakin kadota. Jos tiedon säilyvyys on oleellista sovelluksen toiminnan kannalta, kannattaa se tallentaa esimerkiksi tietokantaan."}]}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Spring luo oletuksena yhden ilmentymän luokasta"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Spring luo oletuksena yhden olion jokaisesta sen hallinnoimasta luokasta — viite tähän yksittäiseen olioon kopioidaan jokaisen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"-annotaatiolla määritellyn olion arvoksi. Joskus hallinnoiduista luokista halutaan kuitenkin useampi versio, esimerkiksi vaikkapa käyttäjäkohtaisesti."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hallinnoitujen olioiden luomista voidaan kontrolloida erillisen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Scope"}]},{"type":"text","value":"-annotaation avulla, mikä mahdollistaa ilmentymien luonnin esimerkiksi sessiokohtaisesti. Seuraavassa on esimerkki ostoskorista, joka on sessiokohtainen: jokaiselle sessiolle luodaan oma ostoskori, eli ostoskori tulee olemaan käyttäjäkohtainen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Alla käytetty annotaatio "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Component"}]},{"type":"text","value":" on luokan toiminnalle oleellinen — se kertoo Springille, että tätäkin luokkaa tulee hallinnoida. Sen avulla Spring tietää, että luokka tulee kopioida "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"-annotaatiolla merkittyihin olioihin."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"// importit"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Data"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@NoArgsConstructor"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Component"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Scope"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"value "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"session\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" proxyMode "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ScopedProxyMode"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"TARGET_CLASS"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"ShoppingCart"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"implements"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Serializable"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Map"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Item"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" items "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"new"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"HashMap"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ylläolevasta komponentista luotavat ilmentymät ovat elossa vain käyttäjän session ajan, eli sen aikaa kun käyttäjän eväste on voimassa. Ylläolevasta ostoskorista saa lisättyä ilmentymän sovellukseen aivan kuten muistakin komponenteista, eli "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"-annotaatiolla."}]},{"type":"element","tagName":"text-box","properties":{"variant":"hint","name":"Mikä ihmeen proxymode?"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tarkempaa tietoa em. annotaatiosta löytyy "},{"type":"element","tagName":"a","properties":{"href":"https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-factory-scopes","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Springin dokumentaatiosta"}]},{"type":"text","value":" ja "},{"type":"element","tagName":"a","properties":{"href":"https://www.baeldung.com/spring-bean-scopes","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Baeldungin aiheeseen liittyvästä oppaasta"}]},{"type":"text","value":"."}]}]},{"type":"element","tagName":"programming-exercise","properties":{"name":"EuroShopper (3 osaa)","tmcname":"osa05-Osa05_03.EuroShopper"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tässä tehtävässä toteutetaan verkkokauppaan ostoskoritoiminnallisuus."}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Ostoskori"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Luo pakkaukseen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"euroshopper"}]},{"type":"text","value":" luokka "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ShoppingCart"}]},{"type":"text","value":", joka tarjoaa seuraavat toiminnallisuudet."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Metodi "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"getItems()"}]},{"type":"text","value":" palauttaa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Map<Item, Long>"}]},{"type":"text","value":"-tyyppisen olion, joka sisältää ostoskorissa olevien tuotteiden tuotekohtaisen lukumäärän."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Metodi "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"addToCart(Item item)"}]},{"type":"text","value":" lisää ostoskoriin yhden kappaleen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Item"}]},{"type":"text","value":"-tyyppistä esinettä."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Kontrolleri ostoskorille"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tee ostoskorista sessiokohtainen, jolloin eri käyttäjien tulee saada eri ostoskori käyttöönsä. Annotaatiosta "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Scope"}]},{"type":"text","value":" on tässä hyötyä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Luo projektiin sopiva kontrolleri, joka tarjoaa seuraavat osoitteet ja toiminnallisuudet."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"GET "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/cart"}]},{"type":"text","value":" asettaa model-olion \"items\"-nimiseen attribuuttiin ostoskorin sisällön (aiempi "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"getItems()"}]},{"type":"text","value":"). Pyynnön vastauksena käyttäjälle näytetään sivu, joka luodaan polussa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/src/main/resources/templates/cart.html"}]},{"type":"text","value":" olevasta näkymästä."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"POST "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/cart/items/{id}"}]},{"type":"text","value":" lisää ostoskoriin yhden {id}-tunnuksella tietokannasta löytyvän Item-olion. Pyyntö ohjataan osoitteeseen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/cart"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Tilauksen tekeminen"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Muokkaa luokkaa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"euroshopper.OrderController"}]},{"type":"text","value":" siten, että kun käyttäjä tekee POST-tyyppisen pyynnön osoitteeseen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/orders"}]},{"type":"text","value":", tilaus tallennetaan tietokantaan. Tutustu luokkiin "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Order"}]},{"type":"text","value":" ja "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"OrderItem"}]},{"type":"text","value":" ennen toteutusta. Varmista että esimerkiksi "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"OrderItem"}]},{"type":"text","value":" viittaa oikeaan tietokantatauluun."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun tilaus on tehty, tyhjennä myös ostoskori."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lisätty 25.11: TMCssä olevan bugin takia nimeä ostoskoria käsittelevä kontrollerisi \"CartController.java\""}]}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Lakiteknisiä asioita evästeisiin liittyen"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Euroopan komissio on säätänyt yksityisyydensuojaan liittyvän lain, joka määrää kertomaan käyttäjille evästeiden käytöstä. Käytännössä käyttäjältä tulee pyytää lupaa minkä tahansa sisällön tallentamiseen hänen koneelleen ("},{"type":"element","tagName":"a","properties":{"href":"https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=CELEX:32002L0058:EN:HTML","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ePrivacy directive, Article 5, kohta (3)"}]},{"type":"text","value":"). Myöhemmin säädetty "},{"type":"element","tagName":"a","properties":{"href":"https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=CELEX:32002L0058:EN:HTML","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tarkennus"}]},{"type":"text","value":" tarkentaa määritelmää myös evästeiden käytön kohdalla."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"(25) However, such devices, for instance so-called \"cookies\", can be a legitimate and useful tool, for example, in analysing the effectiveness of website design and advertising, and in verifying the identity of users engaged in on-line transactions. Where such devices, for instance cookies, are intended for a legitimate purpose, such as to facilitate the provision of information society services, their use should be allowed on condition that users are provided with clear and precise information in accordance with Directive 95/46/EC about the purposes of cookies or similar devices so as to ensure that users are made aware of information being placed on the terminal equipment they are using. Users should have the opportunity to refuse to have a cookie or similar device stored on their terminal equipment. This is particularly important where users other than the original user have access to the terminal equipment and thereby to any data containing privacy-sensitive information stored on such equipment. Information and the right to refuse may be offered once for the use of various devices to be installed on the user's terminal equipment during the same connection and also covering any further use that may be made of those devices during subsequent connections. The methods for giving information, offering a right to refuse or requesting consent should be made as user-friendly as possible. Access to specific website content may still be made conditional on the well-informed acceptance of a cookie or similar device, if it is used for a legitimate purpose."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lisätietoa mm. "},{"type":"element","tagName":"a","properties":{"href":"https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2009:337:0011:0036:EN:PDF","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2009:337:0011:0036:EN:PDF"}]},{"type":"text","value":" ja "},{"type":"element","tagName":"a","properties":{"href":"https://finlex.fi/fi/laki/ajantasa/2014/20140917#L24P205","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://finlex.fi/fi/laki/ajantasa/2014/20140917#L24P205"}]},{"type":"text","value":"."}]}]},"html":"<div><text-box variant='learningObjectives' name='Oppimistavoitteet'><ul>\n<li>Tunnet käsitteen tilattomuus.</li>\n<li>Tiedät mitä evästeet ovat ja mihin niitä käytetään.</li>\n<li>Osaat luoda sovelluksen, joka käyttää evästeitä käyttäjän tunnistamiseen.</li>\n<li>Tunnet evästeisiin liittyviä oleellisia lakiteknisia asioita.</li>\n</ul></text-box><p>HTTP on tilaton protokolla. Tämä tarkoittaa sitä, että jokainen pyyntö on erillinen kokonaisuus, joka ei liity aiempiin pyyntöihin. Suunnittelupäätöksen taustalla oli ajatus siitä, että verkkosivulle ladattava sisältö voi sijaita useammalla eri palvelimella. Jos HTTP ottaisi kantaa käyttäjän tilaan, tulisi myös hajautettujen ratkaisujen tilan ylläpitoon ottaa kantaa — tämä olisi myös ollut melko tehotonta (<a href=\"https://www.w3.org/Protocols/HTTP/HTTP2.html\" target=\"_blank\" rel=\"noopener noreferrer\">Basic HTTP as defined in 1992</a>). Päätös tilattomuudesta on ollut järkevä: suurin osa verkkoliikenteestä liittyy muuttumattoman sisällön hakemiseen, jolloin palvelinten ei tarvitse varata resursseja käyttäjän tilan ylläpitämiseen, eikä palvelinten ja selainohjelmistojen toteuttajien ole tarvinnut toteuttaa mekanismeja käyttäjien tilan ylläpitämiseen.</p><p>Käyttäjän tunnistamiseen pyyntöjen välillä on kuitenkin tarvetta. Esimerkiksi verkkokaupat ja muut käyttäjän kirjautumista vaativat palvelut tarvitsevat tavan käyttäjän tunnistamiseen. Klassinen — mutta huono — tapa käyttäjän tunnistamiseen on ollut säilyttää GET-muotoisessa osoitteessa parametreja, joiden perusteella asiakas voidaan tunnistaa palvelinsovelluksessa. Tämä ei kuitenkaan ole suositeltavaa, sillä osoitteessa olevia parametreja voi muokata käsin.</p><text-box variant='hint' name='Case: GET-parametri tunnistautumiseen'><p>Eräässä järjestelmässä — onneksi jo vuosia sitten — verkkokaupan toiminnallisuus oli toteutettu siten, että GET-parametrina säilytettiin numeerista ostoskorin identifioivaa tunnusta. Käyttäjäkohtaisuus oli toteutettu palvelinpuolella siten, että tietyllä GET-parametrilla näytettiin aina tietyn käyttäjän ostoskori. Uusien tuotteiden lisääminen ostoskoriin onnistui helposti, sillä pyynnöissä oli aina mukana ostoskorin tunnistava GET-parametri. Ostoskorit oli valitettavasti identifioitu juoksevalla numerosarjalla. Henkilöllä 1 oli ostoskori 1, henkilöllä 2 ostoskori 2 jne..</p><p>Koska käytännössä kuka tahansa pääsi katsomaan kenen tahansa ostoskoria vain osoitteessa olevaa numeroa vaihtamalla, olivat ostoskorien sisällöt välillä hyvin mielenkiintoisia.</p></text-box><p>HTTP-protokollan tilattomuus ei pakota palvelinohjelmistoja tilattomuuteen. Mikäli haluamme pitää kirjaa käyttäjistä, löytyy siihen erilaisia keinoja yllä mainitusta GET-parametrin käytöstä lähtien. Toistaiseksi yleisin tekniikka käyttäjän tilan ylläpitoon ja tunnistamiseen on HTTP-pyynnön mukana kulkevat evästeet.</p><h2>HTTP ja evästeet</h2><p>Merkittävä osa verkkosovelluksista sisältää käyttäjäkohtaista toiminnallisuutta, jonka toteuttamiseen sovelluksella täytyy olla jonkinlainen tieto käyttäjästä sekä mahdollisesti käyttäjän tilasta. HTTP-protokollan versio 1.1 sekä uudemmat tarjoavat mahdollisuuden tilallisten verkkosovellusten toteuttamiseen evästeiden (<em>cookies</em>) avulla.</p><p>Evästeet toteutetaan HTTP-protokollan otsakkeiden avulla. Kun käyttäjä tekee pyynnön palvelimelle, ja palvelimella halutaan asettaa käyttäjälle eväste, palautetaan vastauksen osana otsake <code class=\"language-text\">Set-Cookie</code>, jossa määritellään käyttäjäkohtainen evästetunnus. Otsake voi olla esimerkiksi seuraavan näköinen:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Set-Cookie: fb1a1466ccceee22a0=0hr0aa2ogdfgkelogg; Max-Age=3600; Domain=&quot;.helsinki.fi&quot;</code></pre></div><p>Yllä oleva palvelimelta palautettu vastaus pyytää selainta tallettamaan evästeen. Kun selaimella on tiettyyn osoitteeseen liittyvä eväste tallennettuna, tulee sen jatkossa lisätä eväste <code class=\"language-text\">fb1a1466ccceee22a0=0hr0aa2ogdfgkelogg</code> jokaiseen <code class=\"language-text\">helsinki.fi</code>-osoitteeseen lähetettävään pyyntöön. Yllä eväste on voimassa tunnin, eli selain ja palvelin voi unohtaa sen tunnin kuluttua sen asettamisesta.</p><p>Tarkempi syntaksi evästeen asettamiselle on seuraava:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Set-Cookie: nimi=arvo [; Comment=kommentti] [; Max-Age=elinaika sekunteina]\n                    [; Expires=parasta ennen paiva] [; Path=polku tai polunosa jossa eväste voimassa]\n                    [; Domain=palvelimen osoite (URL) tai osoitteen osa jossa eväste voimassa]\n                    [; Secure (jos määritelty, eväste lähetetään vain salatun yhteyden kanssa)]\n                    [; Version=evästeen versio]</code></pre></div><p>Evästeet tallennetaan selaimen sisäiseen evästerekisteriin, josta niitä haetaan aina kun käyttäjä tekee selaimella kyselyn. Evästeet lähetetään palvelimelle jokaisen viestin yhteydessä <code class=\"language-text\">Cookie</code>-otsakkeessa.</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Cookie: fb1a1466ccceee22a0=0hr0aa2ogdfgkelogg</code></pre></div><p>Evästeiden nimet ja arvot ovat yleensä monimutkaisia ja satunnaisesti luotuja niiden yksilöllisyyden takaamiseksi. Tällöin jokaisella käyttäjällä on oma uniikki eväste, jonka käyttäjä lähettää palvelimelle.</p><p>Yleisesti ottaen evästeet ovat sekä hyödyllisiä että haitallisia: niiden avulla voidaan luoda yksiöityjä käyttökokemuksia tarjoavia sovelluksia ja esimerkiksi toteuttaa verkkokauppoja, mutta niitä voidaan käyttää myös käyttäjien seurantaan. Sovellusten kehittäjien pitää myös tiedostaa tämä — esimerkiksi Googlen ilmaiseksi tarjoama <a href=\"https://fi.wikipedia.org/wiki/Google_Analytics\" target=\"_blank\" rel=\"noopener noreferrer\">Google Analytics</a>-palvelu, jota käytetään sivustojen kävijöiden seurantaan, kerää tietoa käyttäjistä. Mikäli tällaisia järjestelmiä käytetään arkaluonteisia tietoja sisältävillä sivuilla, voi käyttäjästä vuotaa yksityiseksi toivottuja tietoja ulkopuolisille tahoille. Tämä on näkynyt myös mediassa — lue <a href=\"https://www.hs.fi/teknologia/art-2000006041757.html\" target=\"_blank\" rel=\"noopener noreferrer\">Helsingin sanomien uutinen aiheesta</a>.</p><text-box variant='hint' name='Evästeet hs.fi -palvelussa'><p>Painamalla F12 tai valitsemalla Tools -> Developer tools, pääset tutkimaan sivun lataamiseen ja sisältöön liittyvää statistiikkaa. Lisäneuvoja löytyy <a href=\"https://developers.google.com/web/tools/chrome-devtools/\" target=\"_blank\" rel=\"noopener noreferrer\">Google Developers</a>-sivustolta.</p><p>Avaa developer tools, ja mene osoitteeseen <a href=\"https://www.hs.fi\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.hs.fi</a>. Valitsemalla developer toolsien välilehden <code class=\"language-text\">Application</code>, löydät valikon erilaisista sivuun liittyvistä resursseista. Etsi kohta <code class=\"language-text\">Storage</code> ja avaa sen alla oleva <code class=\"language-text\">Cookies</code>-kohta. Valitse vaihtoehto <code class=\"language-text\">https://www.hs.fi</code>. Kuinka monta eri evästettä selain lähettää tehdessäsi pyynnön osoitteeseen <code class=\"language-text\">https://www.hs.fi</code>?</p></text-box><h2>Evästeet ja istunnot eli sessiot</h2><p>Kun selain lähettää palvelimelle pyynnön yhteydessä evästeen, palvelin etsii evästeen perusteella käynnissä olevaa istuntoa eli sessiota. Jos sessio löytyy, annetaan siihen liittyvät tiedot sovelluksen käyttöön käyttäjän pyynnön käsittelyä varten. Jos sessiota taas ei löydy, aloitetaan uusi sessio, johon liittyvä eväste palautetaan käyttäjälle vastauksen yhteydessä.</p><p>Javassa sessioiden käsittelyyn löytyy <a href=\"https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html\" target=\"_blank\" rel=\"noopener noreferrer\">HttpSession</a>-luokka, joka tarjoaa välineet sessio- ja käyttäjäkohtaisen tiedon tallentamiseen. Oleellisimmat luokan metodit ovat <code class=\"language-text\">public void setAttribute(String name, Object value)</code>, joka tallentaa sessioon arvon, sekä <code class=\"language-text\">public Object getAttribute(String name)</code>, jonka avulla kyseinen arvo löytyy.</p><p>HttpSession-olion saa Springissä yksinkertaisimmillaan käyttöön lisäämällä sen kontrollerimetodin parametriksi. Tällöin Spring asettaa kyseiseen pyyntöön liittyvän session metodin parametriin automaattisesti. Alla on kuvattuna sovellus, joka pitää sessiokohtaista kirjaa käyttäjien tekemistä pyynnöistä.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSession</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ResponseBody</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">VisitCountController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ResponseBody</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> visits <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            visits <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        visits<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        session<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">,</span> visits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Visits: \"</span> <span class=\"token operator\">+</span> visits<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div><p>Kun käyttäjä tekee ensimmäistä kertaa pyynnön sovellukseen, palauttaa sovellus merkkijonon \"Visits: 1\". Vastauksen yhteydessä palautetaan myös eväste. Kun käyttäjä tekee seuraavan kerran pyynnön sovellukseen, lähettää selain pyynnön yhteydessä myös evästeen palvelimelle, jolloin palvelin osaa tunnistaa käyttäjän ja hakee oikean istunnon tiedot — vastaukseksi palautuu lopulta merkkijono \"Visits: 2\".</p><programming-exercise name='Hello Session' tmcname='osa05-Osa05_01.HelloSession'><p>Toteuta sovellus, joka palauttaa käyttäjälle merkkijonon \"Hello there!\" jos käyttäjä ei ole ennen vieraillut sovelluksessa. Jos käyttäjä on vieraillut sovelluksessa aiemmin, tulee sovelluksen palauttaa käyttäjälle merkkijono \"Hello again!\".</p><p>Palauta merkkijono ensimmäisestä osasta tutun annotaation <code class=\"language-text\">@ResponseBody</code> avulla.</p></programming-exercise><text-box variant='hint' name='Evästeiden ja istuntojen testaaminen selaimella'><p>Istuntojen toiminnallisuuden testaaminen selaimella onnistuu näppärästi selainten tarjoaman anonyymitoiminnallisuuden avulla. Esimerkiksi Chromessa voi valita \"New incognito window\", mikä avaa käyttöön selainikkunan, missä ei aluksi ole lainkaan vanhoja evästeitä muistissa. Kun palvelimelle tehdään pyyntö, tallentuu vastauksen yhteydessä palautettava eväste selaimen muistiin vain siksi aikaa kun anonyymi-ikkuna on auki.</p><p>Session pituus riippuu esimerkiksi palvelimen asetuksista <code class=\"language-text\">session timeout</code> ja siitä, että salliiko käyttäjä evästeiden käytön.</p></text-box><p><code class=\"language-text\">HttpSession</code>-olioon pääsee käsiksi myös muualla sovelluksessa ja sen voi injektoida esimerkiksi palveluun <code class=\"language-text\">@Autowired</code>-annotaation avulla. Edellinen kontrolleriin toteutettu toiminnallisuus voitaisiin tehdä myös palvelussa.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// importit</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CountService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">incrementAndCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            count <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        session<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> count<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div><p>Nyt kontrollerin koodi olisi kevyempi:</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// importit</span>\n\n<span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">VisitCountController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">CountService</span> countService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ResponseBody</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Visits: \"</span> <span class=\"token operator\">+</span> countService<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div><programming-exercise name='Reload Heroes' tmcname='osa05-Osa05_02.ReloadHeroes'><p>Reload Heroes -sovellus pitää kirjaa käyttäjän tekemistä sivun uudelleenlatauksista. Kun käyttäjä saapuu sovellukseen ensimmäistä kertaa, hänelle luodaan satunnainen käyttäjätunnus ja hänen vierailujen määrä asetetaan yhteen. Jokaisen uudelleenvierailun yhteydessä käyttäjän vierailujen määrä kasvaa yhdellä.</p><p>Täydennä luokan <code class=\"language-text\">ReloadController</code> metodin reload toimintaa seuraavasti.</p><ul>\n<li>Metodin tulee palauttaa model-attribuuttina \"scores\" viisi eniten uudelleenlatauksia tehnyttä käyttäjää suuruusjärjestyksessä. Listan ensimmäisellä sijalla on eniten uudelleenlatauksia tehnyt henkilö, toisella sijalla toiseksi eniten jne.</li>\n<li>Metodin tulee lisäksi palauttaa pyynnön tehneeseen henkilöön liittyvä <code class=\"language-text\">ReloadStatus</code>-olio modelin attribuuttina status. Jos käyttäjä ei ole tehnyt yhtäkään pyyntöä aiemmin, tulee käyttäjälle luoda uusi tunnus sekä alustaa uudelleenlatausten määrä yhteen. Jos taas käyttäjä on tehnyt pyyntöjä aiemmin, tulee käyttäjän tekemien pyyntöjen määrää kasvattaa yhdellä. Tieto pyyntöjen määrästä tulee myös tallentaa tietokantaan.</li>\n</ul><p>Voit testata sovelluksen toimintaa selaimen anonyymitilassa. Anonyymitilassa selain ei lähetä normaalitilassa kertyneitä evästeitä palvelimelle.</p></programming-exercise><text-box variant='hint' name='Milloin sessioita kannattaa käyttää?'><p>Muutamia faktoja sessioista:</p><ul>\n<li>Sessio häviää kun käyttäjä poistaa selaimesta evästeet.</li>\n<li>Sessio häviää kun evästeen elinikä kuluu loppuun.</li>\n<li>Jokaisessa päätelaitteessa on tyypillisesti oma sessio: jos palvelua käytetään kännykällä ja padilla, kummallakin on omat evästeet. <em>Tämä on nykyään muuttumassa, esimerkiksi jotkut Googlen tuotteet pitävät kirjaa evästeistä myös laitteiden yli.</em></li>\n<li>Käyttäjä voi estää evästeiden käytön selaimen asetuksista.</li>\n</ul><p>Sessioiden käyttö on näppärää sellaisen tiedon tallentamiseen mikä saakin kadota. Jos tiedon säilyvyys on oleellista sovelluksen toiminnan kannalta, kannattaa se tallentaa esimerkiksi tietokantaan.</p></text-box><h2>Spring luo oletuksena yhden ilmentymän luokasta</h2><p>Spring luo oletuksena yhden olion jokaisesta sen hallinnoimasta luokasta — viite tähän yksittäiseen olioon kopioidaan jokaisen <code class=\"language-text\">@Autowired</code>-annotaatiolla määritellyn olion arvoksi. Joskus hallinnoiduista luokista halutaan kuitenkin useampi versio, esimerkiksi vaikkapa käyttäjäkohtaisesti.</p><p>Hallinnoitujen olioiden luomista voidaan kontrolloida erillisen <code class=\"language-text\">@Scope</code>-annotaation avulla, mikä mahdollistaa ilmentymien luonnin esimerkiksi sessiokohtaisesti. Seuraavassa on esimerkki ostoskorista, joka on sessiokohtainen: jokaiselle sessiolle luodaan oma ostoskori, eli ostoskori tulee olemaan käyttäjäkohtainen.</p><p>Alla käytetty annotaatio <code class=\"language-text\">@Component</code> on luokan toiminnalle oleellinen — se kertoo Springille, että tätäkin luokkaa tulee hallinnoida. Sen avulla Spring tietää, että luokka tulee kopioida <code class=\"language-text\">@Autowired</code>-annotaatiolla merkittyihin olioihin.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// importit</span>\n\n<span class=\"token annotation punctuation\">@Data</span> <span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Scope</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"session\"</span><span class=\"token punctuation\">,</span> proxyMode <span class=\"token operator\">=</span> <span class=\"token class-name\">ScopedProxyMode</span><span class=\"token punctuation\">.</span>TARGET_CLASS<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ShoppingCart</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> items <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div><p>Ylläolevasta komponentista luotavat ilmentymät ovat elossa vain käyttäjän session ajan, eli sen aikaa kun käyttäjän eväste on voimassa. Ylläolevasta ostoskorista saa lisättyä ilmentymän sovellukseen aivan kuten muistakin komponenteista, eli <code class=\"language-text\">@Autowired</code>-annotaatiolla.</p><text-box variant='hint' name='Mikä ihmeen proxymode?'><p>Tarkempaa tietoa em. annotaatiosta löytyy <a href=\"https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-factory-scopes\" target=\"_blank\" rel=\"noopener noreferrer\">Springin dokumentaatiosta</a> ja <a href=\"https://www.baeldung.com/spring-bean-scopes\" target=\"_blank\" rel=\"noopener noreferrer\">Baeldungin aiheeseen liittyvästä oppaasta</a>.</p></text-box><programming-exercise name='EuroShopper (3 osaa)' tmcname='osa05-Osa05_03.EuroShopper'><p>Tässä tehtävässä toteutetaan verkkokauppaan ostoskoritoiminnallisuus.</p><h2>Ostoskori</h2><p>Luo pakkaukseen <code class=\"language-text\">euroshopper</code> luokka <code class=\"language-text\">ShoppingCart</code>, joka tarjoaa seuraavat toiminnallisuudet.</p><ul>\n<li>Metodi <code class=\"language-text\">getItems()</code> palauttaa <code class=\"language-text\">Map&lt;Item, Long&gt;</code>-tyyppisen olion, joka sisältää ostoskorissa olevien tuotteiden tuotekohtaisen lukumäärän.</li>\n<li>Metodi <code class=\"language-text\">addToCart(Item item)</code> lisää ostoskoriin yhden kappaleen <code class=\"language-text\">Item</code>-tyyppistä esinettä.</li>\n</ul><h2>Kontrolleri ostoskorille</h2><p>Tee ostoskorista sessiokohtainen, jolloin eri käyttäjien tulee saada eri ostoskori käyttöönsä. Annotaatiosta <code class=\"language-text\">@Scope</code> on tässä hyötyä.</p><p>Luo projektiin sopiva kontrolleri, joka tarjoaa seuraavat osoitteet ja toiminnallisuudet.</p><ul>\n<li>GET <code class=\"language-text\">/cart</code> asettaa model-olion \"items\"-nimiseen attribuuttiin ostoskorin sisällön (aiempi <code class=\"language-text\">getItems()</code>). Pyynnön vastauksena käyttäjälle näytetään sivu, joka luodaan polussa <code class=\"language-text\">/src/main/resources/templates/cart.html</code> olevasta näkymästä.</li>\n<li>POST <code class=\"language-text\">/cart/items/{id}</code> lisää ostoskoriin yhden {id}-tunnuksella tietokannasta löytyvän Item-olion. Pyyntö ohjataan osoitteeseen <code class=\"language-text\">/cart</code>.</li>\n</ul><h2>Tilauksen tekeminen</h2><p>Muokkaa luokkaa <code class=\"language-text\">euroshopper.OrderController</code> siten, että kun käyttäjä tekee POST-tyyppisen pyynnön osoitteeseen <code class=\"language-text\">/orders</code>, tilaus tallennetaan tietokantaan. Tutustu luokkiin <code class=\"language-text\">Order</code> ja <code class=\"language-text\">OrderItem</code> ennen toteutusta. Varmista että esimerkiksi <code class=\"language-text\">OrderItem</code> viittaa oikeaan tietokantatauluun.</p><p>Kun tilaus on tehty, tyhjennä myös ostoskori.</p><p>Lisätty 25.11: TMCssä olevan bugin takia nimeä ostoskoria käsittelevä kontrollerisi \"CartController.java\"</p></programming-exercise><h2>Lakiteknisiä asioita evästeisiin liittyen</h2><p>Euroopan komissio on säätänyt yksityisyydensuojaan liittyvän lain, joka määrää kertomaan käyttäjille evästeiden käytöstä. Käytännössä käyttäjältä tulee pyytää lupaa minkä tahansa sisällön tallentamiseen hänen koneelleen (<a href=\"https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=CELEX:32002L0058:EN:HTML\" target=\"_blank\" rel=\"noopener noreferrer\">ePrivacy directive, Article 5, kohta (3)</a>). Myöhemmin säädetty <a href=\"https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=CELEX:32002L0058:EN:HTML\" target=\"_blank\" rel=\"noopener noreferrer\">tarkennus</a> tarkentaa määritelmää myös evästeiden käytön kohdalla.</p><p><em>(25) However, such devices, for instance so-called \"cookies\", can be a legitimate and useful tool, for example, in analysing the effectiveness of website design and advertising, and in verifying the identity of users engaged in on-line transactions. Where such devices, for instance cookies, are intended for a legitimate purpose, such as to facilitate the provision of information society services, their use should be allowed on condition that users are provided with clear and precise information in accordance with Directive 95/46/EC about the purposes of cookies or similar devices so as to ensure that users are made aware of information being placed on the terminal equipment they are using. Users should have the opportunity to refuse to have a cookie or similar device stored on their terminal equipment. This is particularly important where users other than the original user have access to the terminal equipment and thereby to any data containing privacy-sensitive information stored on such equipment. Information and the right to refuse may be offered once for the use of various devices to be installed on the user's terminal equipment during the same connection and also covering any further use that may be made of those devices during subsequent connections. The methods for giving information, offering a right to refuse or requesting consent should be made as user-friendly as possible. Access to specific website content may still be made conditional on the well-informed acceptance of a cookie or similar device, if it is used for a legitimate purpose.</em></p><p>Lisätietoa mm. <a href=\"https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2009:337:0011:0036:EN:PDF\" target=\"_blank\" rel=\"noopener noreferrer\">https://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=OJ:L:2009:337:0011:0036:EN:PDF</a> ja <a href=\"https://finlex.fi/fi/laki/ajantasa/2014/20140917#L24P205\" target=\"_blank\" rel=\"noopener noreferrer\">https://finlex.fi/fi/laki/ajantasa/2014/20140917#L24P205</a>.</p></div>","frontmatter":{"path":"/osa-5/1-http-protokollan-tilattomuus-ja-evasteet","title":"HTTP-protokollan tilattomuus ja evästeet"}},"allPages":{"edges":[{"node":{"id":"3283b622-bc08-5a19-9f02-6e3db5b31a9e","frontmatter":{"path":"/arvostelu-ja-kokeet","title":"Arvostelu ja kokeet"}}},{"node":{"id":"e78c9ef5-d275-5bf5-a509-1b9e4c75d71d","frontmatter":{"path":"/ilmoittautuminen","title":"Ilmoittautuminen"}}},{"node":{"id":"76068d63-4a30-5f9e-9efd-ed49edc98b6a","frontmatter":{"path":"/","title":"Tietoa kurssista"}}},{"node":{"id":"61df2549-c6f5-5c67-8b7f-8e9b179914c7","frontmatter":{"path":"/projekti","title":"Projekti"}}},{"node":{"id":"e771e805-db54-5575-a454-bd4c2716760b","frontmatter":{"path":"/osaamistavoitteet","title":"Osaamistavoitteet"}}},{"node":{"id":"5382499e-39f1-5cd3-b8dd-db9394113dd6","frontmatter":{"path":"/tukivaylat","title":"Tukiväylät"}}},{"node":{"id":"da046513-cc80-52ea-982b-6ba29eb36c6f","frontmatter":{"path":"/usein-kysytyt-kysymykset","title":"Usein kysytyt kysymykset"}}},{"node":{"id":"079e1fa2-0d02-5126-86d9-476aff42030b","frontmatter":{"path":"/ekstra/ajan-kasittely-tietokannassa","title":"Ajan käsittely tietokannassa"}}},{"node":{"id":"1af05bdb-9079-516d-be98-e23b12502041","frontmatter":{"path":"/ekstra/tietokantamigraatiot","title":"Tietokantamigraatiot"}}},{"node":{"id":"249178b9-973e-51fb-9b2e-6f9ce2dd2caa","frontmatter":{"path":"/osa-1/1-internetin-perusosat","title":"Internetin perusosat"}}},{"node":{"id":"d3789e1a-41d9-5c85-91ca-f0409e886900","frontmatter":{"path":"/osa-1/2-web-palvelimen-toiminta","title":"Web-palvelimen toiminta"}}},{"node":{"id":"5713905a-c5d4-5ecd-a8ea-115c942d7074","frontmatter":{"path":"/osa-1/3-spring-sovelluskehys","title":"Spring-sovelluskehys"}}},{"node":{"id":"466c1a97-6994-5173-bb91-61d05a30526b","frontmatter":{"path":"/osa-1/4-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"17d35c69-fc92-51be-bc33-4fc9ae222cde","frontmatter":{"path":"/osa-1","title":"Osa 1"}}},{"node":{"id":"3a940cd3-4bbf-51fd-ac1c-41aa09ff32d5","frontmatter":{"path":"/osa-2/1-nakymat-ja-data","title":"Näkymät ja data"}}},{"node":{"id":"bf989dd9-3412-5c74-884a-da6bb6aaac93","frontmatter":{"path":"/osa-2/2-tiedon-lahettaminen-palvelimelle","title":"Tiedon lähettäminen palvelimelle"}}},{"node":{"id":"e291213c-4b28-5f9d-b2e1-54f7d4dbe816","frontmatter":{"path":"/osa-2/3-tietokantojen-kasittely","title":"Tietokantojen käsittely ohjelmallisesti"}}},{"node":{"id":"30ad81c1-8b76-597c-9c62-751757da310b","frontmatter":{"path":"/osa-2/4-polkumuuttujat","title":"Polkumuuttujat"}}},{"node":{"id":"89a245a1-75c1-54b3-a601-672bbd9ec262","frontmatter":{"path":"/osa-2/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"cbe2bc5a-cc26-5910-9f4d-b044ec47abd3","frontmatter":{"path":"/osa-2","title":"Osa 2"}}},{"node":{"id":"b7817525-1953-521b-9e58-8a26d3665534","frontmatter":{"path":"/osa-3/1-useampi-tietokantataulu","title":"Useampi tietokantataulu ja taulujen väliset viitteet"}}},{"node":{"id":"6b7162fe-46bd-56fa-a8d2-41b0781f1c23","frontmatter":{"path":"/osa-3/2-tietokantatransaktiot","title":"Tietokantatransaktiot"}}},{"node":{"id":"7fcb1b86-738d-543a-a2bb-56119be2850c","frontmatter":{"path":"/osa-3/3-n-plus-1-kyselyn-ongelma","title":"N+1 kyselyn ongelma"}}},{"node":{"id":"c15b1320-b951-59b3-86b4-b647e04a54b8","frontmatter":{"path":"/osa-3/4-tulosten-rajaaminen-ja-jarjestaminen","title":"Tietokantakyselyiden tulosten rajaaminen ja järjestäminen"}}},{"node":{"id":"0ea05616-b6f5-54e2-8045-4a86c7c0b197","frontmatter":{"path":"/osa-3/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"8eff6b69-a4e1-5bfb-8d86-f93e7eef7978","frontmatter":{"path":"/osa-3","title":"Osa 3"}}},{"node":{"id":"22ccbbfe-8a60-5d30-a898-e2da567da345","frontmatter":{"path":"/osa-4/1-mediatyyppi-ja-tiedostojen-kasittely","title":"Mediatyyppi ja tiedostojen käsittely"}}},{"node":{"id":"cfcd1e2d-d678-502f-bc30-5ce24a9a29cd","frontmatter":{"path":"/osa-4/2-ohjelmistokehitysprosessi","title":"Muutama sana ohjelmistokehityksestä"}}},{"node":{"id":"2159f129-bc50-5474-97a7-e67d45a13742","frontmatter":{"path":"/osa-4/3-sovelluksen-rakenne","title":"Sovelluksen rakenne"}}},{"node":{"id":"382343a9-8806-5fc7-8c06-2cc69689b180","frontmatter":{"path":"/osa-4/4-konfiguraatioprofiilit","title":"Konfiguraatioprofiilit"}}},{"node":{"id":"708d8201-7107-566a-a74f-4b56444dcd0b","frontmatter":{"path":"/osa-4/5-sovellusten-testaaminen","title":"Sovellusten testaaminen"}}},{"node":{"id":"db8df001-8629-5e13-be04-df87d1afc2b7","frontmatter":{"path":"/osa-4/6-sovelluksen-siirtaminen-pilvipalveluun","title":"Sovelluksen siirtäminen pilvipalveluun"}}},{"node":{"id":"89ca7162-20da-5868-a3eb-5c973045856b","frontmatter":{"path":"/osa-4/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"582a5c8b-beca-5122-a87a-f2cb9068d18a","frontmatter":{"path":"/osa-4","title":"Osa 4"}}},{"node":{"id":"67422910-7142-56bb-80a6-cbd73f7461d3","frontmatter":{"path":"/osa-5/1-http-protokollan-tilattomuus-ja-evasteet","title":"HTTP-protokollan tilattomuus ja evästeet"}}},{"node":{"id":"c65c7fed-73a9-537f-b5f1-3241761326e3","frontmatter":{"path":"/osa-5/2-autentikaatio-ja-autorisaatio","title":"Autentikaatio ja autorisaatio"}}},{"node":{"id":"0428fec4-6ca3-527b-855a-bb3397e65d8c","frontmatter":{"path":"/osa-5/3-nakymatason-ja-metoditason-autorisointi","title":"Näkymä- ja metoditason autorisointi"}}},{"node":{"id":"dd6b12f5-d1ee-54b2-af79-f6f6963f8336","frontmatter":{"path":"/osa-5/4-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"62ff299a-8fe5-58fc-a1f3-010a9ca8ff9d","frontmatter":{"path":"/osa-5","title":"Osa 5"}}},{"node":{"id":"e2bfad01-9334-5cdb-88d1-6509e74db429","frontmatter":{"path":"/osa-6/1-toistuvat-rakenteet-html-sivuilla","title":"Toistuvat rakenteet HTML-sivuilla"}}},{"node":{"id":"59b114a1-6e99-515f-861c-c344839f5f6b","frontmatter":{"path":"/osa-6/2-tyylitiedostot-ja-asettelu","title":"Tyylitiedostot ja sivun asettelun määrittely"}}},{"node":{"id":"3d0269f8-2809-565c-9284-f15ab30559a1","frontmatter":{"path":"/osa-6/3-syotteiden-validointi","title":"Syötteiden validointi"}}},{"node":{"id":"65746c76-9e0b-5c1e-8388-589c3d895db8","frontmatter":{"path":"/osa-6/4-rajapinnat-ja-rest","title":"Rajapinnat ja REST"}}},{"node":{"id":"6c0caa0b-e5f4-5818-b2d0-602f51175ffe","frontmatter":{"path":"/osa-6/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"87285c75-6058-5ed6-af3a-67835f2e9758","frontmatter":{"path":"/osa-6","title":"Osa 6"}}},{"node":{"id":"1edfd6c7-3880-5e94-b639-6c9d80ff7d14","frontmatter":{"path":"/osa-7/1-selainohjelmistot-ja-javascript","title":"Selainohjelmistot ja JavaScript"}}},{"node":{"id":"7c1c61e3-b3e5-5b18-88ab-571ea9f529b8","frontmatter":{"path":"/osa-7/2-tietoturva","title":"Muutama sana tietoturvasta"}}},{"node":{"id":"457aeff4-3970-5308-88c0-cbadc4c4da14","frontmatter":{"path":"/osa-7/3-sovellusten-skaalautuminen","title":"Isommille käyttäjämäärille skaalautuvat sovellukset"}}},{"node":{"id":"40649dd6-c843-59b5-b08b-2ffe5344119c","frontmatter":{"path":"/osa-7/4-reaktiivinen-ohjelmointi","title":"Reaktiivinen ohjelmointi"}}},{"node":{"id":"a1a0b842-6a0f-5dc5-835a-7b47ef681fe4","frontmatter":{"path":"/osa-7/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"a7e70d0e-5b2d-52f5-a5e8-5b9e6fd90aa8","frontmatter":{"path":"/osa-7","title":"Osa 7"}}},{"node":{"id":"8d82aaf9-de05-5ae7-a886-7e21e8781ae3","frontmatter":{"path":"/osa-x/x-johdanto","title":"Johdanto"}}}]}},"pageContext":{}},"staticQueryHashes":["2929037737","994120085"]}