{"componentChunkName":"component---src-templates-course-content-template-js","path":"/osa-4/6-sovelluksen-siirtaminen-pilvipalveluun","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Oppimistavoitteet"},"children":[{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tiedät mitä muutoksia sovellukseen tulee tehdä, jotta se toimii pilvipalvelussa (tässä Heroku)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat siirtää sovelluksesi pilvipalveluun kaikkien nähtäville."}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Tutustutaan seuraavaksi sovelluksen siirtämiseen verkkoon kaikkien saataville. Käytämme tässä "},{"type":"element","tagName":"a","properties":{"href":"https://www.heroku.com/","target":"_blank"},"children":[{"type":"text","value":"Herokua"}]},{"type":"text","value":", joka on rajoitetun (ja ilmaisen) sijoituspaikan sovelluksille tarjoava pilvipalvelu. Herokun ilmaisversiossa sovellus voi olla käynnissä joitakin tunteja päivässä, jonka lisäksi tietokannassa voi olla kerrallaan korkeintaan 10000 riviä. Tämä on riittävä kurssimme puitteissa."}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Heroku tarjoaa "},{"type":"element","tagName":"a","properties":{"href":"https://devcenter.heroku.com/articles/deploying-spring-boot-apps-to-heroku","target":"_blank"},"children":[{"type":"text","value":"oppaan"}]},{"type":"text","value":" Spring Boot -sovelluksen käyttöönottoon Herokussa. Käy opas läpi nyt."}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tarkastellaan seuraavaksi miten kurssin tehtävän voi lisätä Herokuun. Lisäämme Herokuun neljännen osan ensimmäisen tehtävän \"Jokes\". Tehtävän lisääminen verkkoon sisältää muutaman askeleen."}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Herokun käyttämän tietokannanhallintajärjestelmän ajurin määrittely."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tuotantokonfiguraation määrittely."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Sovelluksen käynnistämiseen käytetyn ohjetiedoston määrittely."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Sovelluksen lisäämisen versionhallintaan."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Heroku-projektin luomisen sekä sovelluksen lähettämisen herokuun."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Tietokannanhallintajärjestelmän ajurin määrittely"}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Sovelluksen käytössä olevaan tiedostojärjestelmään mahdollisesti tehtävät muutokset eivät säily sovelluksen uudelleenkäynnistyksen yhteydessä, joten tähän asti käyttämämme tiedostopohjainen H2-tietokannanhallintajärjestelmä ei sovellu sovellukseemme. Heroku käyttää oletuksena "},{"type":"element","tagName":"a","properties":{"href":"https://www.postgresql.org/","target":"_blank"},"children":[{"type":"text","value":"PostgreSQL"}]},{"type":"text","value":"-tietokannanhallintajärjestelmää, jonka se tarjoaa käyttöömme erillisenä palveluna."}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jotta voimme käyttää PostgreSQL-tietokannanhallintajärjestelmää, tarvitsemme sovellukseemme PostgreSQL-ajurin. Ajurin saa käyttöön lisäämällä projektin "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"pom.xml"}]},{"type":"text","value":"-tiedostoon seuraavan riippuvuuden."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"xml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-xml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-xml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"dependency"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"groupId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"org.postgresql"},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"</"}]},{"type":"text","value":"groupId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"artifactId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"postgresql"},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"</"}]},{"type":"text","value":"artifactId"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","tag"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"</"}]},{"type":"text","value":"dependency"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun yllä oleva riippuvuus on määritelty projektiin, on ajuri käytössämme. Mikäli ajuria ei ole aiemmin ladattu koneelle, NetBeansissa joutuu klikkaamaan projektiin liittyvää "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Dependencies"}]},{"type":"text","value":"-kohtaa ja valitsemaan "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Download Declared Dependencies"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Tuotantokonfiguraation määrittely"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Luodaan projektille seuraavaksi tuotantopalvelimen asetukset sisältävä konfiguraatiotiedosto. Käytämme tuotantoprofiilin nimenä merkkijonoa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"production"}]},{"type":"text","value":", joten luodaan sovelluksemme kansioon "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"src/main/resources"}]},{"type":"text","value":" tiedosto "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"application-production.properties"}]},{"type":"text","value":". Oletuksena konfiguraatio peritään "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"application.properties"}]},{"type":"text","value":"-tiedostosta. Tehtäväpohjan tiedostossa määritellään mm. Hibernaten käyttämä kieli, joka on asetettu noudattamaan H2-tietokannanhallintajärjestelmän käytänteitä. Tämä tulee muuttaa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Heroku syöttää käyttöömme merkittävän osan tietokanta-asetuksista valmiiksi, joten pääsemme konfiguraatiossa melko kevyellä. Ainoa oleellinen konfiguraatio on PostgreSQL-tietokannanhallintajärjestelmän käytänteiden seuraaminen. Konfiguraatiotiedoston sisällöstä tulee seuraava."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect"}]}]}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Sovelluksen käynnistämiseen käytetty ohjetiedosto"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Heroku käynnistää sovelluksen sovelluksessa olevan "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Procfile"}]},{"type":"text","value":"-tiedoston perusteella. Lisätään sovelluksen juurikansioon tiedosto "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Procfile"}]},{"type":"text","value":" ja määritellään siihen ohjeet sovelluksen käynnistämiseen. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Procfile"}]},{"type":"text","value":"-tiedoston sisällöksi tulee seuraava:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"web: java $JAVA_OPTS -Dspring.profiles.active=production -Dserver.port=$PORT -jar target/*.jar"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yllä oleva ohjeistus kertoo Herokulle miten sovellus tule käynnistää ja mitä muuttujia sovellukselle tulee antaa käynnistyksen yhteydessä. Yllä sovellukselle annetaan parametrina profiili 'production` sekä portti, johon palvelin käynnistyy. Tätä käytetään sen takia, että yksittäisellä Herokun palvelimella voi olla useita sovelluksia samaan aikaan käynnissä — tiettyyn osoitteeseen tulevat pyynnöt ohjataan aina tiettyyn porttiin."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Mikäli yllä olevaa konfiguraatiotiedostoa ei määritellä, Heroku ei käytä "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"production"}]},{"type":"text","value":"-profiilia. Tällöin mm. PostgreSQL-tietokantaa ei saada käyttöön."}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Sovelluksen lisääminen git-versionhallintaan"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tässä oletamme, että projektia ei ole lisätty versionhallintaan. Alustetaan projektin juureen git-versionhallinta. Heroku käyttää myös git-versionhallintaa, joten voimme myöhemmin lähettää gitin avulla sovelluksemme Herokuun. Huom! Mikäli projektin juuressa on "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"target"}]},{"type":"text","value":"-kansio, suorita komento "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"mvn clean"}]},{"type":"text","value":" ennen seuraavia askeleita."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"user@kone:~projekti$ git init\nuser@kone:~projekti$ git add .\nuser@kone:~projekti$ git commit -m \"ensimmäinen versio\""}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nyt sovellus on näennäisesti versionhallinnassa (vain paikallisella koneellamme)."}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Heroku-projektin luominen ja sovelluksen siirtäminen herokuun"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sovelluksen lisääminen herokuun vaatii sen, että luomme ensin Herokuun uuden (tyhjän) sovelluksen. Tämä onnistuu Herokun komentorivisovelluksella seuraavasti."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"user@kone:~projekti$ heroku create"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Komento luo Herokuun paikan sovelluksellemme sekä määrittelee versionhallintaamme etäosoitteen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"heroku"}]},{"type":"text","value":", johon sovelluksemme voi lähettää. Sovelluksen lähetys Herokuun onnistuu nyt gitin avulla seuraavasti."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"user@kone:~projekti$ git push heroku master"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun sovellus lähetetään Herokuun, Heroku lataa sovellukseen liittyvät riippuvuudet ja käynnistää sen. Tämän jälkeen sovellus on verkossa kaikkien tarkasteltavana. Voit avata sovelluksen selaimeen komennolla "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"heroku open"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"user@kone:~projekti$ heroku open"}]}]}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Sovellus on nyt tarkasteltavissa verkossa. Tätä materiaalia kirjoittaessa Heroku loi sovellukselle osoitteen "},{"type":"element","tagName":"a","properties":{"href":"https://infinite-citadel-61352.herokuapp.com","target":"_blank"},"children":[{"type":"text","value":"https://infinite-citadel-61352.herokuapp.com"}]},{"type":"text","value":". Mikäli sovellus ei vastaa tai se vastaa hitaasti, kyse on siitä, että sovellusta ei ole käytetty vähään aikaan — Heroku sammuttaa sovelluksen silloin kun se ei ole käynnissä, ja käynnistää sovelluksen kun sitä tarvitaan."}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun sovellus on Herokussa, voi sen toimintaa tarkastella lokeista. Komento "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"heroku logs"}]},{"type":"text","value":" on erittäin hyödyllinen virheiden etsinnässä. Tulostettavien rivien määrää voi kasvattaa parametrilla "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-n"}]},{"type":"text","value":" — alla olevassa esimerkissä pyydetään viimeisimmät 500 riviä."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"user@kone:~projekti$ heroku logs -n 500"}]}]}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Muutosten tekeminen sovellukseen"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun sovellus on Herokussa, muutosten lisääminen sovellukseen on suoraviivaista. Kun lähdekoodia on muokattu ja sovellus toimii paikallisesti, uuden version lähettäminen herokuun onnistuu lisäämällä muutokset gitiin, committaamalla muutokset, ja lähettämällä muutokset Herokuun. Tätä ennen kannattaa ajaa komento "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"mvn clean"}]},{"type":"text","value":", joka poistaa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"target"}]},{"type":"text","value":"-kansion."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"user@kone:~projekti$ mvn clean\nuser@kone:~projekti$ git add .\nuser@kone:~projekti$ git commit -m \"seuraava versio\"\nuser@kone:~projekti$ git push heroku master"}]}]}]},{"type":"element","tagName":"text-box","properties":{"variant":"hint","name":"Heroku ja PostgreSQL"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jos Herokun PostgreSQL ei lähde edellä kuvatulla esimerkillä käyntiin, tarkasta vielä, että sovellukseen on lisätty Herokussa tietokannanhallintajärjestelmä. Tämä löytyy Herokusta sovelluksen Resources-välilehdeltä kohdasta Add-ons. Tutustumme hieman myöhemmin tietokantamigraatioihin eli tietokannan rakenteen muuntamiseen tarvittaessa — mikäli haluat, että tietokanta alustetaan alusta, Herokun verkkopalvelusta löytyy toiminnallisuus tietokannan resetointiin."}]}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"27b4640b-c714-5a9b-b91c-b4ae674decce"},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"quiz","properties":{"id":"fd453394-3b96-510a-b5d8-ec86142f0254"},"children":[]}]}]},"html":"<div><text-box variant='learningObjectives' name='Oppimistavoitteet'><ul>\n<li>Tiedät mitä muutoksia sovellukseen tulee tehdä, jotta se toimii pilvipalvelussa (tässä Heroku).</li>\n<li>Osaat siirtää sovelluksesi pilvipalveluun kaikkien nähtäville.</li>\n</ul></text-box><div>Tutustutaan seuraavaksi sovelluksen siirtämiseen verkkoon kaikkien saataville. Käytämme tässä <a href=\"https://www.heroku.com/\" target=\"_blank\">Herokua</a>, joka on rajoitetun (ja ilmaisen) sijoituspaikan sovelluksille tarjoava pilvipalvelu. Herokun ilmaisversiossa sovellus voi olla käynnissä joitakin tunteja päivässä, jonka lisäksi tietokannassa voi olla kerrallaan korkeintaan 10000 riviä. Tämä on riittävä kurssimme puitteissa.</div><br/><div>Heroku tarjoaa <a href=\"https://devcenter.heroku.com/articles/deploying-spring-boot-apps-to-heroku\" target=\"_blank\">oppaan</a> Spring Boot -sovelluksen käyttöönottoon Herokussa. Käy opas läpi nyt.</div><br/><p>Tarkastellaan seuraavaksi miten kurssin tehtävän voi lisätä Herokuun. Lisäämme Herokuun neljännen osan ensimmäisen tehtävän \"Jokes\". Tehtävän lisääminen verkkoon sisältää muutaman askeleen.</p><ol>\n<li>Herokun käyttämän tietokannanhallintajärjestelmän ajurin määrittely.</li>\n<li>Tuotantokonfiguraation määrittely.</li>\n<li>Sovelluksen käynnistämiseen käytetyn ohjetiedoston määrittely.</li>\n<li>Sovelluksen lisäämisen versionhallintaan.</li>\n<li>Heroku-projektin luomisen sekä sovelluksen lähettämisen herokuun.</li>\n</ol><h3>Tietokannanhallintajärjestelmän ajurin määrittely</h3><div>Sovelluksen käytössä olevaan tiedostojärjestelmään mahdollisesti tehtävät muutokset eivät säily sovelluksen uudelleenkäynnistyksen yhteydessä, joten tähän asti käyttämämme tiedostopohjainen H2-tietokannanhallintajärjestelmä ei sovellu sovellukseemme. Heroku käyttää oletuksena <a href=\"https://www.postgresql.org/\" target=\"_blank\">PostgreSQL</a>-tietokannanhallintajärjestelmää, jonka se tarjoaa käyttöömme erillisenä palveluna.</div><br/><p>Jotta voimme käyttää PostgreSQL-tietokannanhallintajärjestelmää, tarvitsemme sovellukseemme PostgreSQL-ajurin. Ajurin saa käyttöön lisäämällä projektin <code class=\"language-text\">pom.xml</code>-tiedostoon seuraavan riippuvuuden.</p><div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.postgresql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>postgresql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></code></pre></div><p>Kun yllä oleva riippuvuus on määritelty projektiin, on ajuri käytössämme. Mikäli ajuria ei ole aiemmin ladattu koneelle, NetBeansissa joutuu klikkaamaan projektiin liittyvää <code class=\"language-text\">Dependencies</code>-kohtaa ja valitsemaan <code class=\"language-text\">Download Declared Dependencies</code>.</p><h3>Tuotantokonfiguraation määrittely</h3><p>Luodaan projektille seuraavaksi tuotantopalvelimen asetukset sisältävä konfiguraatiotiedosto. Käytämme tuotantoprofiilin nimenä merkkijonoa <code class=\"language-text\">production</code>, joten luodaan sovelluksemme kansioon <code class=\"language-text\">src/main/resources</code> tiedosto <code class=\"language-text\">application-production.properties</code>. Oletuksena konfiguraatio peritään <code class=\"language-text\">application.properties</code>-tiedostosta. Tehtäväpohjan tiedostossa määritellään mm. Hibernaten käyttämä kieli, joka on asetettu noudattamaan H2-tietokannanhallintajärjestelmän käytänteitä. Tämä tulee muuttaa.</p><p>Heroku syöttää käyttöömme merkittävän osan tietokanta-asetuksista valmiiksi, joten pääsemme konfiguraatiossa melko kevyellä. Ainoa oleellinen konfiguraatio on PostgreSQL-tietokannanhallintajärjestelmän käytänteiden seuraaminen. Konfiguraatiotiedoston sisällöstä tulee seuraava.</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect</code></pre></div><h3>Sovelluksen käynnistämiseen käytetty ohjetiedosto</h3><p>Heroku käynnistää sovelluksen sovelluksessa olevan <code class=\"language-text\">Procfile</code>-tiedoston perusteella. Lisätään sovelluksen juurikansioon tiedosto <code class=\"language-text\">Procfile</code> ja määritellään siihen ohjeet sovelluksen käynnistämiseen. <code class=\"language-text\">Procfile</code>-tiedoston sisällöksi tulee seuraava:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">web: java $JAVA_OPTS -Dspring.profiles.active=production -Dserver.port=$PORT -jar target/*.jar</code></pre></div><p>Yllä oleva ohjeistus kertoo Herokulle miten sovellus tule käynnistää ja mitä muuttujia sovellukselle tulee antaa käynnistyksen yhteydessä. Yllä sovellukselle annetaan parametrina profiili 'production` sekä portti, johon palvelin käynnistyy. Tätä käytetään sen takia, että yksittäisellä Herokun palvelimella voi olla useita sovelluksia samaan aikaan käynnissä — tiettyyn osoitteeseen tulevat pyynnöt ohjataan aina tiettyyn porttiin.</p><p>Mikäli yllä olevaa konfiguraatiotiedostoa ei määritellä, Heroku ei käytä <code class=\"language-text\">production</code>-profiilia. Tällöin mm. PostgreSQL-tietokantaa ei saada käyttöön.</p><h3>Sovelluksen lisääminen git-versionhallintaan</h3><p>Tässä oletamme, että projektia ei ole lisätty versionhallintaan. Alustetaan projektin juureen git-versionhallinta. Heroku käyttää myös git-versionhallintaa, joten voimme myöhemmin lähettää gitin avulla sovelluksemme Herokuun. Huom! Mikäli projektin juuressa on <code class=\"language-text\">target</code>-kansio, suorita komento <code class=\"language-text\">mvn clean</code> ennen seuraavia askeleita.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">user@kone:~projekti$ git init\nuser@kone:~projekti$ git add .\nuser@kone:~projekti$ git commit -m &quot;ensimmäinen versio&quot;</code></pre></div><p>Nyt sovellus on näennäisesti versionhallinnassa (vain paikallisella koneellamme).</p><h3>Heroku-projektin luominen ja sovelluksen siirtäminen herokuun</h3><p>Sovelluksen lisääminen herokuun vaatii sen, että luomme ensin Herokuun uuden (tyhjän) sovelluksen. Tämä onnistuu Herokun komentorivisovelluksella seuraavasti.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">user@kone:~projekti$ heroku create</code></pre></div><p>Komento luo Herokuun paikan sovelluksellemme sekä määrittelee versionhallintaamme etäosoitteen <code class=\"language-text\">heroku</code>, johon sovelluksemme voi lähettää. Sovelluksen lähetys Herokuun onnistuu nyt gitin avulla seuraavasti.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">user@kone:~projekti$ git push heroku master</code></pre></div><p>Kun sovellus lähetetään Herokuun, Heroku lataa sovellukseen liittyvät riippuvuudet ja käynnistää sen. Tämän jälkeen sovellus on verkossa kaikkien tarkasteltavana. Voit avata sovelluksen selaimeen komennolla <code class=\"language-text\">heroku open</code>.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">user@kone:~projekti$ heroku open</code></pre></div><div>Sovellus on nyt tarkasteltavissa verkossa. Tätä materiaalia kirjoittaessa Heroku loi sovellukselle osoitteen <a href=\"https://infinite-citadel-61352.herokuapp.com\" target=\"_blank\">https://infinite-citadel-61352.herokuapp.com</a>. Mikäli sovellus ei vastaa tai se vastaa hitaasti, kyse on siitä, että sovellusta ei ole käytetty vähään aikaan — Heroku sammuttaa sovelluksen silloin kun se ei ole käynnissä, ja käynnistää sovelluksen kun sitä tarvitaan.</div><br/><p>Kun sovellus on Herokussa, voi sen toimintaa tarkastella lokeista. Komento <code class=\"language-text\">heroku logs</code> on erittäin hyödyllinen virheiden etsinnässä. Tulostettavien rivien määrää voi kasvattaa parametrilla <code class=\"language-text\">-n</code> — alla olevassa esimerkissä pyydetään viimeisimmät 500 riviä.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">user@kone:~projekti$ heroku logs -n 500</code></pre></div><h3>Muutosten tekeminen sovellukseen</h3><p>Kun sovellus on Herokussa, muutosten lisääminen sovellukseen on suoraviivaista. Kun lähdekoodia on muokattu ja sovellus toimii paikallisesti, uuden version lähettäminen herokuun onnistuu lisäämällä muutokset gitiin, committaamalla muutokset, ja lähettämällä muutokset Herokuun. Tätä ennen kannattaa ajaa komento <code class=\"language-text\">mvn clean</code>, joka poistaa <code class=\"language-text\">target</code>-kansion.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">user@kone:~projekti$ mvn clean\nuser@kone:~projekti$ git add .\nuser@kone:~projekti$ git commit -m &quot;seuraava versio&quot;\nuser@kone:~projekti$ git push heroku master</code></pre></div><text-box variant='hint' name='Heroku ja PostgreSQL'><p>Jos Herokun PostgreSQL ei lähde edellä kuvatulla esimerkillä käyntiin, tarkasta vielä, että sovellukseen on lisätty Herokussa tietokannanhallintajärjestelmä. Tämä löytyy Herokusta sovelluksen Resources-välilehdeltä kohdasta Add-ons. Tutustumme hieman myöhemmin tietokantamigraatioihin eli tietokannan rakenteen muuntamiseen tarvittaessa — mikäli haluat, että tietokanta alustetaan alusta, Herokun verkkopalvelusta löytyy toiminnallisuus tietokannan resetointiin.</p></text-box><div><quiz id=\"27b4640b-c714-5a9b-b91c-b4ae674decce\"></quiz>\n<quiz id=\"fd453394-3b96-510a-b5d8-ec86142f0254\"></quiz></div></div>","frontmatter":{"path":"/osa-4/6-sovelluksen-siirtaminen-pilvipalveluun","title":"Sovelluksen siirtäminen pilvipalveluun"}},"allPages":{"edges":[{"node":{"id":"3283b622-bc08-5a19-9f02-6e3db5b31a9e","frontmatter":{"path":"/arvostelu-ja-kokeet","title":"Arvostelu ja kokeet"}}},{"node":{"id":"e78c9ef5-d275-5bf5-a509-1b9e4c75d71d","frontmatter":{"path":"/ilmoittautuminen","title":"Ilmoittautuminen"}}},{"node":{"id":"76068d63-4a30-5f9e-9efd-ed49edc98b6a","frontmatter":{"path":"/","title":"Tietoa kurssista"}}},{"node":{"id":"61df2549-c6f5-5c67-8b7f-8e9b179914c7","frontmatter":{"path":"/projekti","title":"Projekti"}}},{"node":{"id":"e771e805-db54-5575-a454-bd4c2716760b","frontmatter":{"path":"/osaamistavoitteet","title":"Osaamistavoitteet"}}},{"node":{"id":"5382499e-39f1-5cd3-b8dd-db9394113dd6","frontmatter":{"path":"/tukivaylat","title":"Tukiväylät"}}},{"node":{"id":"da046513-cc80-52ea-982b-6ba29eb36c6f","frontmatter":{"path":"/usein-kysytyt-kysymykset","title":"Usein kysytyt kysymykset"}}},{"node":{"id":"079e1fa2-0d02-5126-86d9-476aff42030b","frontmatter":{"path":"/ekstra/ajan-kasittely-tietokannassa","title":"Ajan käsittely tietokannassa"}}},{"node":{"id":"1af05bdb-9079-516d-be98-e23b12502041","frontmatter":{"path":"/ekstra/tietokantamigraatiot","title":"Tietokantamigraatiot"}}},{"node":{"id":"d3789e1a-41d9-5c85-91ca-f0409e886900","frontmatter":{"path":"/osa-1/2-web-palvelimen-toiminta","title":"Web-palvelimen toiminta"}}},{"node":{"id":"249178b9-973e-51fb-9b2e-6f9ce2dd2caa","frontmatter":{"path":"/osa-1/1-internetin-perusosat","title":"Internetin perusosat"}}},{"node":{"id":"5713905a-c5d4-5ecd-a8ea-115c942d7074","frontmatter":{"path":"/osa-1/3-spring-sovelluskehys","title":"Spring-sovelluskehys"}}},{"node":{"id":"466c1a97-6994-5173-bb91-61d05a30526b","frontmatter":{"path":"/osa-1/4-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"17d35c69-fc92-51be-bc33-4fc9ae222cde","frontmatter":{"path":"/osa-1","title":"Osa 1"}}},{"node":{"id":"3a940cd3-4bbf-51fd-ac1c-41aa09ff32d5","frontmatter":{"path":"/osa-2/1-nakymat-ja-data","title":"Näkymät ja data"}}},{"node":{"id":"bf989dd9-3412-5c74-884a-da6bb6aaac93","frontmatter":{"path":"/osa-2/2-tiedon-lahettaminen-palvelimelle","title":"Tiedon lähettäminen palvelimelle"}}},{"node":{"id":"e291213c-4b28-5f9d-b2e1-54f7d4dbe816","frontmatter":{"path":"/osa-2/3-tietokantojen-kasittely","title":"Tietokantojen käsittely ohjelmallisesti"}}},{"node":{"id":"30ad81c1-8b76-597c-9c62-751757da310b","frontmatter":{"path":"/osa-2/4-polkumuuttujat","title":"Polkumuuttujat"}}},{"node":{"id":"89a245a1-75c1-54b3-a601-672bbd9ec262","frontmatter":{"path":"/osa-2/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"cbe2bc5a-cc26-5910-9f4d-b044ec47abd3","frontmatter":{"path":"/osa-2","title":"Osa 2"}}},{"node":{"id":"b7817525-1953-521b-9e58-8a26d3665534","frontmatter":{"path":"/osa-3/1-useampi-tietokantataulu","title":"Useampi tietokantataulu ja taulujen väliset viitteet"}}},{"node":{"id":"6b7162fe-46bd-56fa-a8d2-41b0781f1c23","frontmatter":{"path":"/osa-3/2-tietokantatransaktiot","title":"Tietokantatransaktiot"}}},{"node":{"id":"7fcb1b86-738d-543a-a2bb-56119be2850c","frontmatter":{"path":"/osa-3/3-n-plus-1-kyselyn-ongelma","title":"N+1 kyselyn ongelma"}}},{"node":{"id":"c15b1320-b951-59b3-86b4-b647e04a54b8","frontmatter":{"path":"/osa-3/4-tulosten-rajaaminen-ja-jarjestaminen","title":"Tietokantakyselyiden tulosten rajaaminen ja järjestäminen"}}},{"node":{"id":"0ea05616-b6f5-54e2-8045-4a86c7c0b197","frontmatter":{"path":"/osa-3/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"8eff6b69-a4e1-5bfb-8d86-f93e7eef7978","frontmatter":{"path":"/osa-3","title":"Osa 3"}}},{"node":{"id":"22ccbbfe-8a60-5d30-a898-e2da567da345","frontmatter":{"path":"/osa-4/1-mediatyyppi-ja-tiedostojen-kasittely","title":"Mediatyyppi ja tiedostojen käsittely"}}},{"node":{"id":"cfcd1e2d-d678-502f-bc30-5ce24a9a29cd","frontmatter":{"path":"/osa-4/2-ohjelmistokehitysprosessi","title":"Muutama sana ohjelmistokehityksestä"}}},{"node":{"id":"2159f129-bc50-5474-97a7-e67d45a13742","frontmatter":{"path":"/osa-4/3-sovelluksen-rakenne","title":"Sovelluksen rakenne"}}},{"node":{"id":"382343a9-8806-5fc7-8c06-2cc69689b180","frontmatter":{"path":"/osa-4/4-konfiguraatioprofiilit","title":"Konfiguraatioprofiilit"}}},{"node":{"id":"708d8201-7107-566a-a74f-4b56444dcd0b","frontmatter":{"path":"/osa-4/5-sovellusten-testaaminen","title":"Sovellusten testaaminen"}}},{"node":{"id":"db8df001-8629-5e13-be04-df87d1afc2b7","frontmatter":{"path":"/osa-4/6-sovelluksen-siirtaminen-pilvipalveluun","title":"Sovelluksen siirtäminen pilvipalveluun"}}},{"node":{"id":"89ca7162-20da-5868-a3eb-5c973045856b","frontmatter":{"path":"/osa-4/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"582a5c8b-beca-5122-a87a-f2cb9068d18a","frontmatter":{"path":"/osa-4","title":"Osa 4"}}},{"node":{"id":"67422910-7142-56bb-80a6-cbd73f7461d3","frontmatter":{"path":"/osa-5/1-http-protokollan-tilattomuus-ja-evasteet","title":"HTTP-protokollan tilattomuus ja evästeet"}}},{"node":{"id":"c65c7fed-73a9-537f-b5f1-3241761326e3","frontmatter":{"path":"/osa-5/2-autentikaatio-ja-autorisaatio","title":"Autentikaatio ja autorisaatio"}}},{"node":{"id":"0428fec4-6ca3-527b-855a-bb3397e65d8c","frontmatter":{"path":"/osa-5/3-nakymatason-ja-metoditason-autorisointi","title":"Näkymä- ja metoditason autorisointi"}}},{"node":{"id":"dd6b12f5-d1ee-54b2-af79-f6f6963f8336","frontmatter":{"path":"/osa-5/4-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"62ff299a-8fe5-58fc-a1f3-010a9ca8ff9d","frontmatter":{"path":"/osa-5","title":"Osa 5"}}},{"node":{"id":"e2bfad01-9334-5cdb-88d1-6509e74db429","frontmatter":{"path":"/osa-6/1-toistuvat-rakenteet-html-sivuilla","title":"Toistuvat rakenteet HTML-sivuilla"}}},{"node":{"id":"59b114a1-6e99-515f-861c-c344839f5f6b","frontmatter":{"path":"/osa-6/2-tyylitiedostot-ja-asettelu","title":"Tyylitiedostot ja sivun asettelun määrittely"}}},{"node":{"id":"3d0269f8-2809-565c-9284-f15ab30559a1","frontmatter":{"path":"/osa-6/3-syotteiden-validointi","title":"Syötteiden validointi"}}},{"node":{"id":"65746c76-9e0b-5c1e-8388-589c3d895db8","frontmatter":{"path":"/osa-6/4-rajapinnat-ja-rest","title":"Rajapinnat ja REST"}}},{"node":{"id":"6c0caa0b-e5f4-5818-b2d0-602f51175ffe","frontmatter":{"path":"/osa-6/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"87285c75-6058-5ed6-af3a-67835f2e9758","frontmatter":{"path":"/osa-6","title":"Osa 6"}}},{"node":{"id":"1edfd6c7-3880-5e94-b639-6c9d80ff7d14","frontmatter":{"path":"/osa-7/1-selainohjelmistot-ja-javascript","title":"Selainohjelmistot ja JavaScript"}}},{"node":{"id":"7c1c61e3-b3e5-5b18-88ab-571ea9f529b8","frontmatter":{"path":"/osa-7/2-tietoturva","title":"Muutama sana tietoturvasta"}}},{"node":{"id":"457aeff4-3970-5308-88c0-cbadc4c4da14","frontmatter":{"path":"/osa-7/3-sovellusten-skaalautuminen","title":"Isommille käyttäjämäärille skaalautuvat sovellukset"}}},{"node":{"id":"40649dd6-c843-59b5-b08b-2ffe5344119c","frontmatter":{"path":"/osa-7/4-reaktiivinen-ohjelmointi","title":"Reaktiivinen ohjelmointi"}}},{"node":{"id":"a1a0b842-6a0f-5dc5-835a-7b47ef681fe4","frontmatter":{"path":"/osa-7/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"a7e70d0e-5b2d-52f5-a5e8-5b9e6fd90aa8","frontmatter":{"path":"/osa-7","title":"Osa 7"}}},{"node":{"id":"8d82aaf9-de05-5ae7-a886-7e21e8781ae3","frontmatter":{"path":"/osa-x/x-johdanto","title":"Johdanto"}}}]}},"pageContext":{}},"staticQueryHashes":["2929037737","994120085"]}