{"componentChunkName":"component---src-templates-course-content-template-js","path":"/osa-4/3-sovelluksen-rakenne","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Oppimistavoitteet"},"children":[{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tiedät MVC-arkkitehtuurin ja kerrosarkkitehtuurin."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tiedät mitä Front Controller -suunnittelumalli tarkoittaa."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Osaat jakaa sovelluksen pienempiin sovelluksen sisäisiin palveluihin."}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Web-sovellusten suunnittelussa noudatetaan useita arkkitehtuurimalleja. Tyypillisimpiä näistä ovat MVC-arkkitehtuuri sekä kerrosarkkitehtuuri. Kummassakin perusperiaatteena on vastuiden jako selkeisiin osakokonaisuuksiin."}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"MVC-arkkitehtuuri"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"MVC-arkkitehtuurin tavoitteena on käyttöliittymän erottaminen sovelluksen toiminnasta siten, että käyttöliittymät eivät sisällä sovelluksen toiminnan kannalta tärkeää sovelluslogiikkaa. MVC-arkkitehtuurissa ohjelmisto jaetaan kolmeen osaan: malliin ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"model"}]},{"type":"text","value":", tiedon tallennus- ja hakutoiminnallisuus), näkymään ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"view"}]},{"type":"text","value":", käyttöliittymän ulkoasu ja tiedon esitystapa) ja käsittelijään ("},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"controller"}]},{"type":"text","value":", käyttäjältä saatujen käskyjen käsittely sekä sovelluslogiikka)."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"MVC-malli yhdistetään tyypillisesti työpöytäsovelluksiin, missä käsittelijä voi olla jatkuvassa yhteydessä näkymään ja malliin. Tällöin käyttäjän yksittäinen toiminta käyttöliittymässä — esimerkiksi tekstikentän tiedon päivitys — liittyy tapahtumankäsittelijään, joka ohjaa tiedon malliin liittyvälle ohjelmakoodille, jonka tehtävänä on päivittää sovellukseen liittyvää tietoa tarvittaessa. Tapahtumankäsittelijä mahdollisesti sisältää myös ohjelmakoodia, joka pyytää muunnosta käyttöliittymässä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Web-sovelluksissa käsittelijän ohjelmakoodia suoritetaan vain kun selain lähettää palvelimelle pyynnön. Ohjelmakoodissa haetaan esimerkiksi tietokannasta tietoa, joka ohjataan näkymän luontiin tarkoitetulle sovelluksen osalle. Kun näkymä on luotu, palautetaan se pyynnön tehneelle selaimelle. Spring-sovelluksissa kontrollereissa näkyvä "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Model"}]},{"type":"text","value":" viittaa tietoon, jota käytetään näkymän luomisessa — se ei kuitenkaan vastaa MVC-mallin termiä model, joka liittyy kattavammin koko tietokantatoiminnallisuuteen."}]},{"type":"element","tagName":"figure","properties":{},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 576px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/b9bc065caa1c62ee357e9aacfb8069dc/533c1/web-mvcish.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 33.47826086956522%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAAz0lEQVQY042Pyw5EQBBF+/9/zFoiJGJFvNoziEGj51CJmN3cRfXznqqrzvO01lLneba31nX93JqmaRiGfd+P4+i6blkW+yslC+a2bcUQRVGe51VVJUniOI7neWmaBkHAE9xt2+T/ZdZas8Cu6zqOY+nPvigKYfFE8yzLmqYBx42YkfJ9n0Pf9+B5k0HKssTMkbE5GmPgcoPT3AJ3mcdxlJxcgRAz8UhBTn4/UQGRKAxDIriuy1zqSS8xRGRmTirN4T5z0pAe4ABR1dvz3v+jL0uWkrLpLIEsAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/b9bc065caa1c62ee357e9aacfb8069dc/a0b58/web-mvcish.webp 230w","/static/b9bc065caa1c62ee357e9aacfb8069dc/bc10c/web-mvcish.webp 460w","/static/b9bc065caa1c62ee357e9aacfb8069dc/6264f/web-mvcish.webp 576w"],"sizes":["(max-width:","576px)","100vw,","576px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/b9bc065caa1c62ee357e9aacfb8069dc/81c8e/web-mvcish.png 230w","/static/b9bc065caa1c62ee357e9aacfb8069dc/08a84/web-mvcish.png 460w","/static/b9bc065caa1c62ee357e9aacfb8069dc/533c1/web-mvcish.png 576w"],"sizes":["(max-width:","576px)","100vw,","576px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/b9bc065caa1c62ee357e9aacfb8069dc/533c1/web-mvcish.png","alt":"web mvcish","title":"web mvcish","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"\n    Web-sovelluksissa käyttäjän pyyntö ohjautuu kontrollerille, joka sisältää sovelluslogiikkaa. Kontrolleri kutsuu pyynnöstä riippuen mallin toiminnallisuuksia ja hakee sieltä esimerkiksi tietoa. Tämän jälkeen pyyntö ohjataan näkymän luomisesta vastuussa olevalle komponentille ja näkymä luodaan. Lopulta näkymä palautetaan vastauksena käyttäjän tekemälle pyynnölle.\n  "}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"MVC-mallin perusidean noudattamisesta on useita hyötyjä. Käyttöliittymien (näkymien) suunnittelu ja toteutus voidaan eriyttää sovelluslogiikan toteuttamisesta, jolloin niitä voidaan työstää rinnakkain. Samalla ohjelmakoodi selkenee, sillä komponenttien vastuut ovat eriteltyjä — näkymät eivät sisällä sovelluslogiikkaa, kontrollerin tehtävänä on käsitellä pyynnöt ja ohjata niitä eteenpäin, ja mallin vastuulla on tietoon liittyvät operaatiot. Tämän lisäksi sovellukseen voidaan luoda useampia käyttöliittymiä, joista jokainen käyttää samaa sovelluslogiikkaa, ja pyynnön kulku sovelluksessa selkiytyy."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"b4da1523-5dba-58d5-9e6f-771395c86dfb"},"children":[]}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Kerrosarkkitehtuuri"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kun sovellus jaetaan selkeisiin vastuualueisiin, selkeytyy myös pyynnön kulku sovelluksessa. Kerrosarkkitehtuuria noudattamalla pyritään tilanteeseen, missä sovellus on jaettu itsenäisiin kerroksiin, jotka toimivat vuorovaikutuksessa muiden kerrosten kanssa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Spring-sovellusten yhteydessä kerrosarkkitehtuurilla tarkoitetaan yleisesti ottaen seuraavaa jakoa:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Käyttöliittymäkerros"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Kontrollerikerros"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Sovelluslogiikka ja palvelut"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tallennuslogiikka (tietokanta-abstraktio ja tietokantapalvelut)"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kerrosarkkitehtuuria noudattaessa ylempi kerros hyödyntää alemman kerroksen tarjoamia toiminnallisuuksia, mutta alempi kerros ei hyödynnä ylempien kerrosten tarjoamia palveluita. Puhtaassa kerrosarkkitehtuurissa kaikki kerrokset ovat olemassa, ja kutsut eivät ohita kerroksia ylhäältä alaspäin kulkiessaan. Tällä kurssilla noudatamme avointa kerrosarkkitehtuuria, missä kerrosten ohittaminen on sallittua — jos sovelluksen ylläpidettävyys ja rakenne ei sitä kiellä, voi myös Repository-rajapinnan toteuttavat oliot sisällyttää kontrollereihin."}]},{"type":"element","tagName":"figure","properties":{},"children":[{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 448px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/ba95076b6bcd764b6da795d309b1aebe/33b38/layers.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2klEQVQ4y42T147CQAxF8/9fwitCCIkH4AUhSmii1yCa6L0uhD3g7CyZBbSWQI5n7rWv7TFuP3a5XM7n83q9PhwOs9ksl8udTqfbRzP42bbN/3g8zufz2Wy22WxmMhn8+XyuTsXsh+lgFZ1Op9VqVcM82/V6dYHFvh62Wq3K5bJc2m63m80GOQowHA5hXy6XksDo9/vUWa/X+Q4EAiDb7Tb/lUolEon4fL5CoUALBDwajUqlEqStVusOnkwm8O12O+okulgsOp0O3MfjkQhpKYfMSpRlWUSAuMpWx6T6q1k+yUwCJlIsFu9goiIJPtq73+9hxWds5G80GshWYAoEzGmtVnMyU1sikUgmkx6Ph38K63a7zCwUCsViMcQrMHS9Xg+HQf6WDT0HOGwImqFDsypYaaYc0uI73dbGCJjdUoI15YiSzaHNDhgl5KFVODJePrmEAxfZaOFgMOAmQUThIIrqDG6nUinTNNPpdDweJ8oMmbzf72fOtIB2RKNRwdBnWkA5TmY8uKlHHgYOenBITkRbZoKwQOFq2PPSs21CrDSrhqlFlp67HobcQB4SoHj5PPRX9Wyw0m2v1xsOhz+8LYnrYFQFg0HA8rbegV9nxmR7b/8w493B55xi340KdxxvFaYoAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/ba95076b6bcd764b6da795d309b1aebe/a0b58/layers.webp 230w","/static/ba95076b6bcd764b6da795d309b1aebe/76be4/layers.webp 448w"],"sizes":["(max-width:","448px)","100vw,","448px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/ba95076b6bcd764b6da795d309b1aebe/81c8e/layers.png 230w","/static/ba95076b6bcd764b6da795d309b1aebe/33b38/layers.png 448w"],"sizes":["(max-width:","448px)","100vw,","448px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/ba95076b6bcd764b6da795d309b1aebe/33b38/layers.png","alt":"layers","title":"layers","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"figcaption","properties":{},"children":[{"type":"text","value":"\n    Kerrosarkkitehtuurissa sovelluksen vastuut jaetaan kerroksittain. Näkymäkerros sisältää käyttöliittymät, joista voidaan tehdä pyyntöjä kontrollerille. Kontrolleri käsittelee palveluita, jotka ovat yhteydessä tallennuslogiikkaan. Tiedon tallentamiseen käytettäviä entiteettejä sekä muita luokkia (esim \"view objects\") käytetään kaikilla kerroksilla.\n  "}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Käyttöliittymäkerros sisältää näkymät (esim. Thymeleafin html-sivut) sekä mahdollisen logiikan tiedon näyttämiseen (esim tägit html-sivuilla). Käyttöliittymä näkyy käyttäjän selaimessa, ja käyttäjän selain tekee palvelimelle pyyntöjä käyttöliittymässä tehtyjen klikkausten ja muiden toimintojen pohjalta. Palvelimella toimivan sovelluksen kontrollerikerros ottaa vastaan nämä pyynnöt, ja ohjaa ne eteenpäin sovelluksen sisällä."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tarkastellaan seuraavaksi kontrollerikerrosta, sovelluslogiikkaa ja palveluita sekä tallennuslogiikkaa."}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Kontrollerikerros"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kontrollerien ensisijaisena vastuuna on pyyntöjen kuuntelu, pyyntöjen ohjaaminen sopiville palveluille, sekä tuotetun tiedon ohjaaminen oikealle näkymälle tai näkymän generoivalle komponentille."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Jotta palveluille ei ohjata epäoleellista dataa, esimerkiksi huonoja arvoja sisältäviä parametreja, on kontrolleritason vastuulla myös pyynnössä olevien parametrien validointi. Opimme validoimaan syötteitä hieman myöhemmin tällä kurssilla."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kontrollerikerroksen luokissa käytetään annotaatiota "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Controller"}]},{"type":"text","value":", ja luokkien metodit, jotka vastaanottavat pyyntöjä annotoidaan esimerkiksi "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@GetMapping"}]},{"type":"text","value":"- ja "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@PostMapping"}]},{"type":"text","value":"-annotaatioilla."}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Palvelukerros"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Palvelukerros tarjoaa kontrollerikerrokselle palveluita. Palvelut voivat esimerkiksi abstrahoida kolmannen osapuolen tarjoamia komponentteja tai rajapintoja, tai sisältää toiminnallisuutta, jonka toteuttaminen kontrollerissa ei ole järkevää esimerkiksi sovelluksen ylläpidettävyyden kannalta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Palvelukerroksen luokat merkitään annotaatiolla "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":" tai "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Component"}]},{"type":"text","value":". Tämä annotaatio tarkoittaa käytännössä sitä, että sovelluksen käynnistyessä luokasta tehdään olio, joka ladataan sovelluksen muistiin. Tämän jälkeen jokaiseen luotavaan olioon, jonka luokassa on "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"-annotaatiolla merkitty oliomuuttuja, sisällytetään muistiin ladattu olio."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tarkastellaan edellisessä osassa ollutta tehtävää Bank Transfer sekä sen erästä mahdollista ratkaisua. Tehtävässä tavoitteena oli luoda sovellus, joka voi tehdä tilisiirron parametreina annettujen tilien välillä. Eräs ratkaisu on seuraavanlainen."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingController"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":" accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"list"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Model"}]},{"type":"text","value":" model"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        model"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"addAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"accounts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findAll"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@PostMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transfer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Account"}]},{"type":"text","value":" accountFrom "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIban"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Account"}]},{"type":"text","value":" accountTo "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIban"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        accountFrom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"accountFrom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        accountTo"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"accountTo"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"redirect:/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yllä olevassa esimerkissä kontrollerin metodi "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"transfer"}]},{"type":"text","value":" sisältää melko paljon sovelluslogiikkaa (noh, todellisuudessa 5 riviä ei ole vielä kovin paljoa). Erotetaan esimerkinomaisesti sovelluslogiikka kontrollerista ja luodaan erillinen luokka "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":", joka sisältää pankkisovellukseen liittyvää sovelluslogiikkaa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Luokka "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" annotoidaan annotaatiolla "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":", jonka takia se päätyy Springin hallinnoimaksi. Tämä tarkoittaa sitä, että luokkaan voi injektoida springin hallinnoimia olioita ja että luokasta tehdyn olion voi injektoida muihin Springin hallinnoimiin luokkiin."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lisätään luokkaan tietokantatoiminnalisuus."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":" accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ja metodi tilisiirron tekemiseen."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":" accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transfer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Account"}]},{"type":"text","value":" accountFrom "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIban"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Account"}]},{"type":"text","value":" accountTo "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIban"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        accountFrom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"accountFrom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        accountTo"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"accountTo"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kuten yltä huomaa, myös annotaation "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":" voi määritellä myös "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":"-annotaatiolla merkittyihin luokkiin."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nyt "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingController"}]},{"type":"text","value":"-luokan toiminnallisuus kevenee hieman."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingController"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":" accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" bankingService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"list"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Model"}]},{"type":"text","value":" model"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        model"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"addAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"accounts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findAll"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@PostMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transfer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n                           "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"bankingService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transfer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"redirect:/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yllä kontrolleriluokan metodi transfer on selkeä ja sen vastuulla on vain pyynnön vastaanottaminen sekä tehtävien delegointi."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ehkäpä oleellisimpana etuna yllä olevassa muunnoksessa on se, että jatkossa myös muut tilisiirtoa mahdollisesti tarvitsevat sovelluksen osat voivat hyödyntää suoraan "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":"-luokassa määriteltyä metodia."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tarkastellaan luokkaa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingController"}]},{"type":"text","value":" vielä hieman. Luokkaan on injektoitu sekä aiemmin luomamme "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" että "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":". Tässä on esimerkki avoimesta arkkitehtuurista, jonka eräänä mahdollisena haittana on injektoitujen olioiden määrän kasvaminen. Puhtaassa arkkitehtuurissa kontrolleri ei riippuisi suoraan tietokannan muokkaamiseen liittyvästä "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":"-luokasta, vaan palvelutason komponentti "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" tarjoaisi myös metodin tilien hakemiseen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lisätään luokkaan "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" toiminnallisuus tilien hakemiseen ja muokataan luokkaa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingController"}]},{"type":"text","value":" hyödyntämään tätä toiminnallisuutta."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":" accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"List"}]},{"type":"element","tagName":"span","properties":{"className":["token","generics"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Account"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":">"}]}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"list"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findAll"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Transactional"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"void"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transfer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Account"}]},{"type":"text","value":" accountFrom "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIban"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Account"}]},{"type":"text","value":" accountTo "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"accountRepository"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"findByIban"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n        accountFrom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"accountFrom"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        accountTo"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"setBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"accountTo"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"getBalance"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"+"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nyt luokassa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"BankingController"}]},{"type":"text","value":" ei enää tarvita suoraa riippuvuutta tietokanta-abstraktioon "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"AccountRepository"}]},{"type":"text","value":". Muokattuna toteutus on seuraava."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"java"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-java"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingController"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@Autowired"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"private"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"BankingService"}]},{"type":"text","value":" bankingService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@GetMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"list"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Model"}]},{"type":"text","value":" model"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        model"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"addAttribute"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"accounts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"bankingService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"list"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"index\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@PostMapping"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transfer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"String"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n                           "},{"type":"element","tagName":"span","properties":{"className":["token","annotation","punctuation"]},"children":[{"type":"text","value":"@RequestParam"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"Integer"}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"this"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"bankingService"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"transfer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"from"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"to"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" amount"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"redirect:/\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"programming-exercise","properties":{"name":"Jokes","tmcname":"osa04-Osa04_03.Jokes"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tehtäväpohjassa on vitsejä kolmannen osapuolen verkkopalvelusta hakeva ja niitä käyttäjälle näyttävä sovellus. Sovellus tarjoaa vitsien tarkastelun lisäksi mahdollisuuden vitsien hyvyyden äänestämiseen. Tällä hetkellä sovelluksen luokka "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"JokeController"}]},{"type":"text","value":" sisältää vitsien äänestämiseen liittyvää toiminnallisuutta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Muokkaa sovelusta siten, että luot erillisen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"VoteService"}]},{"type":"text","value":"-luokan, joka kapseloi äänestystoiminnallisuuden. Uudessa versiossa luokan "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"JokeController"}]},{"type":"text","value":" ei tule käyttää rajapintaa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"VoteRepository"}]},{"type":"text","value":" muuten kuin välillisesti "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"VoteService"}]},{"type":"text","value":"-luokan kautta."}]}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Tallennuslogiikka"}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Tallennuslogiikkakerros sisältää tiedon tallentamiseen liittyvät oleelliset oliot. Tämä sisältää niin relaatiotietokantojen käsittelyyn tarkoitettujen "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"JpaRepository"}]},{"type":"text","value":"-rajapinnan perivät rajapinnat kuin muiden tietokantojen ja tietovarastojen käsittelyyn tarkoitetut luokat. Spring-sovelluksissa tiedon käsittelyyn käytetään tyypillisesti "},{"type":"element","tagName":"a","properties":{"href":"https://spring.io/projects/spring-data","target":"_blank"},"children":[{"type":"text","value":"Spring Data"}]},{"type":"text","value":"-projektia, joka tarjoaa välineitä hyvin monenkaltaisten tietokantojen käsittelyyn. Esimerkiksi suositun "},{"type":"element","tagName":"a","properties":{"href":"https://www.mongodb.com/","target":"_blank"},"children":[{"type":"text","value":"MongoDB"}]},{"type":"text","value":"-tietokannanhallintajärjestelmän käyttöönotto onnistuu "},{"type":"element","tagName":"a","properties":{"href":"https://spring.io/projects/spring-data-mongodb","target":"_blank"},"children":[{"type":"text","value":"Spring Data MongoDB"}]},{"type":"text","value":"-projektin avulla kun taas hyvin laajat projektit voivat käyttää vaikkapa "},{"type":"element","tagName":"a","properties":{"href":"https://cassandra.apache.org/","target":"_blank"},"children":[{"type":"text","value":"Apache Cassandraa"}]},{"type":"text","value":" "},{"type":"element","tagName":"a","properties":{"href":"https://spring.io/projects/spring-data-cassandra","target":"_blank"},"children":[{"type":"text","value":"Spring Data Cassandra"}]},{"type":"text","value":"-projektin avulla."}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Tällä kurssilla käsittelemme Spring-sovelluskehyksen tarjoamia tallennusmahdollisuuksia hyvin pintapuolisesti, vain "},{"type":"element","tagName":"a","properties":{"href":"https://spring.io/projects/spring-data-jpa","target":"_blank"},"children":[{"type":"text","value":"Spring Data JPA"}]},{"type":"text","value":"-projektia hyödyntäen. Tämä on tarkoituksenmukaista, sillä oikeastaan yhdellä kurssilla ei voisi mitenkään käsitellä kaikkia tiedon käsittelyyn tarjolla olevia välineitä."}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Tietoa sisältävät oliot"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tiedon esittämiseen liittyvät oliot elävät kerrosarkkitehtuurissa kerrosten sivulla. Esimerkiksi entiteettejä voidaan käsitellä tallennuslogiikkakerroksella (tiedon tallennus), palvelukerroksella (tiedon käsittely), kontrollerikerroksella (tiedon lisääminen Model-olioon) sekä näkymäkerroksella (Model-olion käyttäminen näkymän luomiseen."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sovellusten kehittämisessä näkee välillä myös jaon useampaan erilaiseen tietoa sisältävään oliotyyppiin. Entiteettejä käytetään tietokantatoiminnallisuudessa, mutta välillä näkymien käsittelyyn palautettavat oliot pidetään erillisinä entiteeteistä. Tähän ei ole oikeastaan yhtä oikeaa tapaa: lähestymistapa valitaan tyypillisesti ohjelmistokehitystiimin kesken."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"quiz","properties":{"id":"eb4e637e-7948-55b1-819d-6422f69201b9"},"children":[]}]}]},"html":"<div><text-box variant='learningObjectives' name='Oppimistavoitteet'><ul>\n<li>Tiedät MVC-arkkitehtuurin ja kerrosarkkitehtuurin.</li>\n<li>Tiedät mitä Front Controller -suunnittelumalli tarkoittaa.</li>\n<li>Osaat jakaa sovelluksen pienempiin sovelluksen sisäisiin palveluihin.</li>\n</ul></text-box><p>Web-sovellusten suunnittelussa noudatetaan useita arkkitehtuurimalleja. Tyypillisimpiä näistä ovat MVC-arkkitehtuuri sekä kerrosarkkitehtuuri. Kummassakin perusperiaatteena on vastuiden jako selkeisiin osakokonaisuuksiin.</p><h3>MVC-arkkitehtuuri</h3><p>MVC-arkkitehtuurin tavoitteena on käyttöliittymän erottaminen sovelluksen toiminnasta siten, että käyttöliittymät eivät sisällä sovelluksen toiminnan kannalta tärkeää sovelluslogiikkaa. MVC-arkkitehtuurissa ohjelmisto jaetaan kolmeen osaan: malliin (<em>model</em>, tiedon tallennus- ja hakutoiminnallisuus), näkymään (<em>view</em>, käyttöliittymän ulkoasu ja tiedon esitystapa) ja käsittelijään (<em>controller</em>, käyttäjältä saatujen käskyjen käsittely sekä sovelluslogiikka).</p><p>MVC-malli yhdistetään tyypillisesti työpöytäsovelluksiin, missä käsittelijä voi olla jatkuvassa yhteydessä näkymään ja malliin. Tällöin käyttäjän yksittäinen toiminta käyttöliittymässä — esimerkiksi tekstikentän tiedon päivitys — liittyy tapahtumankäsittelijään, joka ohjaa tiedon malliin liittyvälle ohjelmakoodille, jonka tehtävänä on päivittää sovellukseen liittyvää tietoa tarvittaessa. Tapahtumankäsittelijä mahdollisesti sisältää myös ohjelmakoodia, joka pyytää muunnosta käyttöliittymässä.</p><p>Web-sovelluksissa käsittelijän ohjelmakoodia suoritetaan vain kun selain lähettää palvelimelle pyynnön. Ohjelmakoodissa haetaan esimerkiksi tietokannasta tietoa, joka ohjataan näkymän luontiin tarkoitetulle sovelluksen osalle. Kun näkymä on luotu, palautetaan se pyynnön tehneelle selaimelle. Spring-sovelluksissa kontrollereissa näkyvä <code class=\"language-text\">Model</code> viittaa tietoon, jota käytetään näkymän luomisessa — se ei kuitenkaan vastaa MVC-mallin termiä model, joka liittyy kattavammin koko tietokantatoiminnallisuuteen.</p><figure>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 576px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b9bc065caa1c62ee357e9aacfb8069dc/533c1/web-mvcish.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.47826086956522%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAAz0lEQVQY042Pyw5EQBBF+/9/zFoiJGJFvNoziEGj51CJmN3cRfXznqqrzvO01lLneba31nX93JqmaRiGfd+P4+i6blkW+yslC+a2bcUQRVGe51VVJUniOI7neWmaBkHAE9xt2+T/ZdZas8Cu6zqOY+nPvigKYfFE8yzLmqYBx42YkfJ9n0Pf9+B5k0HKssTMkbE5GmPgcoPT3AJ3mcdxlJxcgRAz8UhBTn4/UQGRKAxDIriuy1zqSS8xRGRmTirN4T5z0pAe4ABR1dvz3v+jL0uWkrLpLIEsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/b9bc065caa1c62ee357e9aacfb8069dc/a0b58/web-mvcish.webp 230w,\n/static/b9bc065caa1c62ee357e9aacfb8069dc/bc10c/web-mvcish.webp 460w,\n/static/b9bc065caa1c62ee357e9aacfb8069dc/6264f/web-mvcish.webp 576w\" sizes=\"(max-width: 576px) 100vw, 576px\" type=\"image/webp\">\n        <source srcset=\"/static/b9bc065caa1c62ee357e9aacfb8069dc/81c8e/web-mvcish.png 230w,\n/static/b9bc065caa1c62ee357e9aacfb8069dc/08a84/web-mvcish.png 460w,\n/static/b9bc065caa1c62ee357e9aacfb8069dc/533c1/web-mvcish.png 576w\" sizes=\"(max-width: 576px) 100vw, 576px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/b9bc065caa1c62ee357e9aacfb8069dc/533c1/web-mvcish.png\" alt=\"web mvcish\" title=\"web mvcish\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span>\n  <figcaption>\n    Web-sovelluksissa k&#xE4;ytt&#xE4;j&#xE4;n pyynt&#xF6; ohjautuu kontrollerille, joka sis&#xE4;lt&#xE4;&#xE4; sovelluslogiikkaa. Kontrolleri kutsuu pyynn&#xF6;st&#xE4; riippuen mallin toiminnallisuuksia ja hakee sielt&#xE4; esimerkiksi tietoa. T&#xE4;m&#xE4;n j&#xE4;lkeen pyynt&#xF6; ohjataan n&#xE4;kym&#xE4;n luomisesta vastuussa olevalle komponentille ja n&#xE4;kym&#xE4; luodaan. Lopulta n&#xE4;kym&#xE4; palautetaan vastauksena k&#xE4;ytt&#xE4;j&#xE4;n tekem&#xE4;lle pyynn&#xF6;lle.\n  </figcaption>\n</figure><p>MVC-mallin perusidean noudattamisesta on useita hyötyjä. Käyttöliittymien (näkymien) suunnittelu ja toteutus voidaan eriyttää sovelluslogiikan toteuttamisesta, jolloin niitä voidaan työstää rinnakkain. Samalla ohjelmakoodi selkenee, sillä komponenttien vastuut ovat eriteltyjä — näkymät eivät sisällä sovelluslogiikkaa, kontrollerin tehtävänä on käsitellä pyynnöt ja ohjata niitä eteenpäin, ja mallin vastuulla on tietoon liittyvät operaatiot. Tämän lisäksi sovellukseen voidaan luoda useampia käyttöliittymiä, joista jokainen käyttää samaa sovelluslogiikkaa, ja pyynnön kulku sovelluksessa selkiytyy.</p><div><quiz id=\"b4da1523-5dba-58d5-9e6f-771395c86dfb\"></quiz></div><h3>Kerrosarkkitehtuuri</h3><p>Kun sovellus jaetaan selkeisiin vastuualueisiin, selkeytyy myös pyynnön kulku sovelluksessa. Kerrosarkkitehtuuria noudattamalla pyritään tilanteeseen, missä sovellus on jaettu itsenäisiin kerroksiin, jotka toimivat vuorovaikutuksessa muiden kerrosten kanssa.</p><p>Spring-sovellusten yhteydessä kerrosarkkitehtuurilla tarkoitetaan yleisesti ottaen seuraavaa jakoa:</p><ul>\n<li>Käyttöliittymäkerros</li>\n<li>Kontrollerikerros</li>\n<li>Sovelluslogiikka ja palvelut</li>\n<li>Tallennuslogiikka (tietokanta-abstraktio ja tietokantapalvelut)</li>\n</ul><p>Kerrosarkkitehtuuria noudattaessa ylempi kerros hyödyntää alemman kerroksen tarjoamia toiminnallisuuksia, mutta alempi kerros ei hyödynnä ylempien kerrosten tarjoamia palveluita. Puhtaassa kerrosarkkitehtuurissa kaikki kerrokset ovat olemassa, ja kutsut eivät ohita kerroksia ylhäältä alaspäin kulkiessaan. Tällä kurssilla noudatamme avointa kerrosarkkitehtuuria, missä kerrosten ohittaminen on sallittua — jos sovelluksen ylläpidettävyys ja rakenne ei sitä kiellä, voi myös Repository-rajapinnan toteuttavat oliot sisällyttää kontrollereihin.</p><figure>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 448px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ba95076b6bcd764b6da795d309b1aebe/33b38/layers.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2klEQVQ4y42T147CQAxF8/9fwitCCIkH4AUhSmii1yCa6L0uhD3g7CyZBbSWQI5n7rWv7TFuP3a5XM7n83q9PhwOs9ksl8udTqfbRzP42bbN/3g8zufz2Wy22WxmMhn8+XyuTsXsh+lgFZ1Op9VqVcM82/V6dYHFvh62Wq3K5bJc2m63m80GOQowHA5hXy6XksDo9/vUWa/X+Q4EAiDb7Tb/lUolEon4fL5CoUALBDwajUqlEqStVusOnkwm8O12O+okulgsOp0O3MfjkQhpKYfMSpRlWUSAuMpWx6T6q1k+yUwCJlIsFu9goiIJPtq73+9hxWds5G80GshWYAoEzGmtVnMyU1sikUgmkx6Ph38K63a7zCwUCsViMcQrMHS9Xg+HQf6WDT0HOGwImqFDsypYaaYc0uI73dbGCJjdUoI15YiSzaHNDhgl5KFVODJePrmEAxfZaOFgMOAmQUThIIrqDG6nUinTNNPpdDweJ8oMmbzf72fOtIB2RKNRwdBnWkA5TmY8uKlHHgYOenBITkRbZoKwQOFq2PPSs21CrDSrhqlFlp67HobcQB4SoHj5PPRX9Wyw0m2v1xsOhz+8LYnrYFQFg0HA8rbegV9nxmR7b/8w493B55xi340KdxxvFaYoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/ba95076b6bcd764b6da795d309b1aebe/a0b58/layers.webp 230w,\n/static/ba95076b6bcd764b6da795d309b1aebe/76be4/layers.webp 448w\" sizes=\"(max-width: 448px) 100vw, 448px\" type=\"image/webp\">\n        <source srcset=\"/static/ba95076b6bcd764b6da795d309b1aebe/81c8e/layers.png 230w,\n/static/ba95076b6bcd764b6da795d309b1aebe/33b38/layers.png 448w\" sizes=\"(max-width: 448px) 100vw, 448px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/ba95076b6bcd764b6da795d309b1aebe/33b38/layers.png\" alt=\"layers\" title=\"layers\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span>\n  <figcaption>\n    Kerrosarkkitehtuurissa sovelluksen vastuut jaetaan kerroksittain. N&#xE4;kym&#xE4;kerros sis&#xE4;lt&#xE4;&#xE4; k&#xE4;ytt&#xF6;liittym&#xE4;t, joista voidaan tehd&#xE4; pyynt&#xF6;j&#xE4; kontrollerille. Kontrolleri k&#xE4;sittelee palveluita, jotka ovat yhteydess&#xE4; tallennuslogiikkaan. Tiedon tallentamiseen k&#xE4;ytett&#xE4;vi&#xE4; entiteettej&#xE4; sek&#xE4; muita luokkia (esim &quot;view objects&quot;) k&#xE4;ytet&#xE4;&#xE4;n kaikilla kerroksilla.\n  </figcaption>\n</figure><p>Käyttöliittymäkerros sisältää näkymät (esim. Thymeleafin html-sivut) sekä mahdollisen logiikan tiedon näyttämiseen (esim tägit html-sivuilla). Käyttöliittymä näkyy käyttäjän selaimessa, ja käyttäjän selain tekee palvelimelle pyyntöjä käyttöliittymässä tehtyjen klikkausten ja muiden toimintojen pohjalta. Palvelimella toimivan sovelluksen kontrollerikerros ottaa vastaan nämä pyynnöt, ja ohjaa ne eteenpäin sovelluksen sisällä.</p><p>Tarkastellaan seuraavaksi kontrollerikerrosta, sovelluslogiikkaa ja palveluita sekä tallennuslogiikkaa.</p><h3>Kontrollerikerros</h3><p>Kontrollerien ensisijaisena vastuuna on pyyntöjen kuuntelu, pyyntöjen ohjaaminen sopiville palveluille, sekä tuotetun tiedon ohjaaminen oikealle näkymälle tai näkymän generoivalle komponentille.</p><p>Jotta palveluille ei ohjata epäoleellista dataa, esimerkiksi huonoja arvoja sisältäviä parametreja, on kontrolleritason vastuulla myös pyynnössä olevien parametrien validointi. Opimme validoimaan syötteitä hieman myöhemmin tällä kurssilla.</p><p>Kontrollerikerroksen luokissa käytetään annotaatiota <code class=\"language-text\">@Controller</code>, ja luokkien metodit, jotka vastaanottavat pyyntöjä annotoidaan esimerkiksi <code class=\"language-text\">@GetMapping</code>- ja <code class=\"language-text\">@PostMapping</code>-annotaatioilla.</p><h3>Palvelukerros</h3><p>Palvelukerros tarjoaa kontrollerikerrokselle palveluita. Palvelut voivat esimerkiksi abstrahoida kolmannen osapuolen tarjoamia komponentteja tai rajapintoja, tai sisältää toiminnallisuutta, jonka toteuttaminen kontrollerissa ei ole järkevää esimerkiksi sovelluksen ylläpidettävyyden kannalta.</p><p>Palvelukerroksen luokat merkitään annotaatiolla <code class=\"language-text\">@Service</code> tai <code class=\"language-text\">@Component</code>. Tämä annotaatio tarkoittaa käytännössä sitä, että sovelluksen käynnistyessä luokasta tehdään olio, joka ladataan sovelluksen muistiin. Tämän jälkeen jokaiseen luotavaan olioon, jonka luokassa on <code class=\"language-text\">@Autowired</code>-annotaatiolla merkitty oliomuuttuja, sisällytetään muistiin ladattu olio.</p><p>Tarkastellaan edellisessä osassa ollutta tehtävää Bank Transfer sekä sen erästä mahdollista ratkaisua. Tehtävässä tavoitteena oli luoda sovellus, joka voi tehdä tilisiirron parametreina annettujen tilien välillä. Eräs ratkaisu on seuraavanlainen.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BankingController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountRepository</span> accountRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accounts\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"index\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> from<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">Integer</span> amount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Account</span> accountFrom <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIban</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Account</span> accountTo <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIban</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        accountFrom<span class=\"token punctuation\">.</span><span class=\"token function\">setBalance</span><span class=\"token punctuation\">(</span>accountFrom<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        accountTo<span class=\"token punctuation\">.</span><span class=\"token function\">setBalance</span><span class=\"token punctuation\">(</span>accountTo<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div><p>Yllä olevassa esimerkissä kontrollerin metodi <code class=\"language-text\">transfer</code> sisältää melko paljon sovelluslogiikkaa (noh, todellisuudessa 5 riviä ei ole vielä kovin paljoa). Erotetaan esimerkinomaisesti sovelluslogiikka kontrollerista ja luodaan erillinen luokka <code class=\"language-text\">BankingService</code>, joka sisältää pankkisovellukseen liittyvää sovelluslogiikkaa.</p><p>Luokka <code class=\"language-text\">BankingService</code> annotoidaan annotaatiolla <code class=\"language-text\">@Service</code>, jonka takia se päätyy Springin hallinnoimaksi. Tämä tarkoittaa sitä, että luokkaan voi injektoida springin hallinnoimia olioita ja että luokasta tehdyn olion voi injektoida muihin Springin hallinnoimiin luokkiin.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BankingService</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div><p>Lisätään luokkaan tietokantatoiminnalisuus.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BankingService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountRepository</span> accountRepository<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div><p>Ja metodi tilisiirron tekemiseen.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BankingService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountRepository</span> accountRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> from<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> amount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Account</span> accountFrom <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIban</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Account</span> accountTo <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIban</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        accountFrom<span class=\"token punctuation\">.</span><span class=\"token function\">setBalance</span><span class=\"token punctuation\">(</span>accountFrom<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        accountTo<span class=\"token punctuation\">.</span><span class=\"token function\">setBalance</span><span class=\"token punctuation\">(</span>accountTo<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div><p>Kuten yltä huomaa, myös annotaation <code class=\"language-text\">@Transactional</code> voi määritellä myös <code class=\"language-text\">@Service</code>-annotaatiolla merkittyihin luokkiin.</p><p>Nyt <code class=\"language-text\">BankingController</code>-luokan toiminnallisuus kevenee hieman.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BankingController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountRepository</span> accountRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">BankingService</span> bankingService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accounts\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"index\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> from<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span>\n                           <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">Integer</span> amount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bankingService<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">,</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div><p>Yllä kontrolleriluokan metodi transfer on selkeä ja sen vastuulla on vain pyynnön vastaanottaminen sekä tehtävien delegointi.</p><p>Ehkäpä oleellisimpana etuna yllä olevassa muunnoksessa on se, että jatkossa myös muut tilisiirtoa mahdollisesti tarvitsevat sovelluksen osat voivat hyödyntää suoraan <code class=\"language-text\">BankingService</code>-luokassa määriteltyä metodia.</p><p>Tarkastellaan luokkaa <code class=\"language-text\">BankingController</code> vielä hieman. Luokkaan on injektoitu sekä aiemmin luomamme <code class=\"language-text\">BankingService</code> että <code class=\"language-text\">AccountRepository</code>. Tässä on esimerkki avoimesta arkkitehtuurista, jonka eräänä mahdollisena haittana on injektoitujen olioiden määrän kasvaminen. Puhtaassa arkkitehtuurissa kontrolleri ei riippuisi suoraan tietokannan muokkaamiseen liittyvästä <code class=\"language-text\">AccountRepository</code>-luokasta, vaan palvelutason komponentti <code class=\"language-text\">BankingService</code> tarjoaisi myös metodin tilien hakemiseen.</p><p>Lisätään luokkaan <code class=\"language-text\">BankingService</code> toiminnallisuus tilien hakemiseen ja muokataan luokkaa <code class=\"language-text\">BankingController</code> hyödyntämään tätä toiminnallisuutta.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BankingService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccountRepository</span> accountRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Account</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> from<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span> amount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Account</span> accountFrom <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIban</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Account</span> accountTo <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>accountRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByIban</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">to</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        accountFrom<span class=\"token punctuation\">.</span><span class=\"token function\">setBalance</span><span class=\"token punctuation\">(</span>accountFrom<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        accountTo<span class=\"token punctuation\">.</span><span class=\"token function\">setBalance</span><span class=\"token punctuation\">(</span>accountTo<span class=\"token punctuation\">.</span><span class=\"token function\">getBalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div><p>Nyt luokassa <code class=\"language-text\">BankingController</code> ei enää tarvita suoraa riippuvuutta tietokanta-abstraktioon <code class=\"language-text\">AccountRepository</code>. Muokattuna toteutus on seuraava.</p><div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BankingController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">BankingService</span> bankingService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"accounts\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bankingService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"index\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> from<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span>\n                           <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">Integer</span> amount<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>bankingService<span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">,</span> <span class=\"token keyword\">to</span><span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div><programming-exercise name='Jokes' tmcname='osa04-Osa04_03.Jokes'><p>Tehtäväpohjassa on vitsejä kolmannen osapuolen verkkopalvelusta hakeva ja niitä käyttäjälle näyttävä sovellus. Sovellus tarjoaa vitsien tarkastelun lisäksi mahdollisuuden vitsien hyvyyden äänestämiseen. Tällä hetkellä sovelluksen luokka <code class=\"language-text\">JokeController</code> sisältää vitsien äänestämiseen liittyvää toiminnallisuutta.</p><p>Muokkaa sovelusta siten, että luot erillisen <code class=\"language-text\">VoteService</code>-luokan, joka kapseloi äänestystoiminnallisuuden. Uudessa versiossa luokan <code class=\"language-text\">JokeController</code> ei tule käyttää rajapintaa <code class=\"language-text\">VoteRepository</code> muuten kuin välillisesti <code class=\"language-text\">VoteService</code>-luokan kautta.</p></programming-exercise><h3>Tallennuslogiikka</h3><div>Tallennuslogiikkakerros sisältää tiedon tallentamiseen liittyvät oleelliset oliot. Tämä sisältää niin relaatiotietokantojen käsittelyyn tarkoitettujen <code class=\"language-text\">JpaRepository</code>-rajapinnan perivät rajapinnat kuin muiden tietokantojen ja tietovarastojen käsittelyyn tarkoitetut luokat. Spring-sovelluksissa tiedon käsittelyyn käytetään tyypillisesti <a href=\"https://spring.io/projects/spring-data\" target=\"_blank\">Spring Data</a>-projektia, joka tarjoaa välineitä hyvin monenkaltaisten tietokantojen käsittelyyn. Esimerkiksi suositun <a href=\"https://www.mongodb.com/\" target=\"_blank\">MongoDB</a>-tietokannanhallintajärjestelmän käyttöönotto onnistuu <a href=\"https://spring.io/projects/spring-data-mongodb\" target=\"_blank\">Spring Data MongoDB</a>-projektin avulla kun taas hyvin laajat projektit voivat käyttää vaikkapa <a href=\"https://cassandra.apache.org/\" target=\"_blank\">Apache Cassandraa</a> <a href=\"https://spring.io/projects/spring-data-cassandra\" target=\"_blank\">Spring Data Cassandra</a>-projektin avulla.</div><br/><div>Tällä kurssilla käsittelemme Spring-sovelluskehyksen tarjoamia tallennusmahdollisuuksia hyvin pintapuolisesti, vain <a href=\"https://spring.io/projects/spring-data-jpa\" target=\"_blank\">Spring Data JPA</a>-projektia hyödyntäen. Tämä on tarkoituksenmukaista, sillä oikeastaan yhdellä kurssilla ei voisi mitenkään käsitellä kaikkia tiedon käsittelyyn tarjolla olevia välineitä.</div><br/><h3>Tietoa sisältävät oliot</h3><p>Tiedon esittämiseen liittyvät oliot elävät kerrosarkkitehtuurissa kerrosten sivulla. Esimerkiksi entiteettejä voidaan käsitellä tallennuslogiikkakerroksella (tiedon tallennus), palvelukerroksella (tiedon käsittely), kontrollerikerroksella (tiedon lisääminen Model-olioon) sekä näkymäkerroksella (Model-olion käyttäminen näkymän luomiseen.</p><p>Sovellusten kehittämisessä näkee välillä myös jaon useampaan erilaiseen tietoa sisältävään oliotyyppiin. Entiteettejä käytetään tietokantatoiminnallisuudessa, mutta välillä näkymien käsittelyyn palautettavat oliot pidetään erillisinä entiteeteistä. Tähän ei ole oikeastaan yhtä oikeaa tapaa: lähestymistapa valitaan tyypillisesti ohjelmistokehitystiimin kesken.</p><div><quiz id=\"eb4e637e-7948-55b1-819d-6422f69201b9\"></quiz></div></div>","frontmatter":{"path":"/osa-4/3-sovelluksen-rakenne","title":"Sovelluksen rakenne"}},"allPages":{"edges":[{"node":{"id":"3283b622-bc08-5a19-9f02-6e3db5b31a9e","frontmatter":{"path":"/arvostelu-ja-kokeet","title":"Arvostelu ja kokeet"}}},{"node":{"id":"e78c9ef5-d275-5bf5-a509-1b9e4c75d71d","frontmatter":{"path":"/ilmoittautuminen","title":"Ilmoittautuminen"}}},{"node":{"id":"76068d63-4a30-5f9e-9efd-ed49edc98b6a","frontmatter":{"path":"/","title":"Tietoa kurssista"}}},{"node":{"id":"61df2549-c6f5-5c67-8b7f-8e9b179914c7","frontmatter":{"path":"/projekti","title":"Projekti"}}},{"node":{"id":"e771e805-db54-5575-a454-bd4c2716760b","frontmatter":{"path":"/osaamistavoitteet","title":"Osaamistavoitteet"}}},{"node":{"id":"5382499e-39f1-5cd3-b8dd-db9394113dd6","frontmatter":{"path":"/tukivaylat","title":"Tukiväylät"}}},{"node":{"id":"da046513-cc80-52ea-982b-6ba29eb36c6f","frontmatter":{"path":"/usein-kysytyt-kysymykset","title":"Usein kysytyt kysymykset"}}},{"node":{"id":"079e1fa2-0d02-5126-86d9-476aff42030b","frontmatter":{"path":"/ekstra/ajan-kasittely-tietokannassa","title":"Ajan käsittely tietokannassa"}}},{"node":{"id":"1af05bdb-9079-516d-be98-e23b12502041","frontmatter":{"path":"/ekstra/tietokantamigraatiot","title":"Tietokantamigraatiot"}}},{"node":{"id":"249178b9-973e-51fb-9b2e-6f9ce2dd2caa","frontmatter":{"path":"/osa-1/1-internetin-perusosat","title":"Internetin perusosat"}}},{"node":{"id":"d3789e1a-41d9-5c85-91ca-f0409e886900","frontmatter":{"path":"/osa-1/2-web-palvelimen-toiminta","title":"Web-palvelimen toiminta"}}},{"node":{"id":"5713905a-c5d4-5ecd-a8ea-115c942d7074","frontmatter":{"path":"/osa-1/3-spring-sovelluskehys","title":"Spring-sovelluskehys"}}},{"node":{"id":"466c1a97-6994-5173-bb91-61d05a30526b","frontmatter":{"path":"/osa-1/4-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"17d35c69-fc92-51be-bc33-4fc9ae222cde","frontmatter":{"path":"/osa-1","title":"Osa 1"}}},{"node":{"id":"3a940cd3-4bbf-51fd-ac1c-41aa09ff32d5","frontmatter":{"path":"/osa-2/1-nakymat-ja-data","title":"Näkymät ja data"}}},{"node":{"id":"bf989dd9-3412-5c74-884a-da6bb6aaac93","frontmatter":{"path":"/osa-2/2-tiedon-lahettaminen-palvelimelle","title":"Tiedon lähettäminen palvelimelle"}}},{"node":{"id":"e291213c-4b28-5f9d-b2e1-54f7d4dbe816","frontmatter":{"path":"/osa-2/3-tietokantojen-kasittely","title":"Tietokantojen käsittely ohjelmallisesti"}}},{"node":{"id":"30ad81c1-8b76-597c-9c62-751757da310b","frontmatter":{"path":"/osa-2/4-polkumuuttujat","title":"Polkumuuttujat"}}},{"node":{"id":"89a245a1-75c1-54b3-a601-672bbd9ec262","frontmatter":{"path":"/osa-2/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"cbe2bc5a-cc26-5910-9f4d-b044ec47abd3","frontmatter":{"path":"/osa-2","title":"Osa 2"}}},{"node":{"id":"b7817525-1953-521b-9e58-8a26d3665534","frontmatter":{"path":"/osa-3/1-useampi-tietokantataulu","title":"Useampi tietokantataulu ja taulujen väliset viitteet"}}},{"node":{"id":"6b7162fe-46bd-56fa-a8d2-41b0781f1c23","frontmatter":{"path":"/osa-3/2-tietokantatransaktiot","title":"Tietokantatransaktiot"}}},{"node":{"id":"7fcb1b86-738d-543a-a2bb-56119be2850c","frontmatter":{"path":"/osa-3/3-n-plus-1-kyselyn-ongelma","title":"N+1 kyselyn ongelma"}}},{"node":{"id":"c15b1320-b951-59b3-86b4-b647e04a54b8","frontmatter":{"path":"/osa-3/4-tulosten-rajaaminen-ja-jarjestaminen","title":"Tietokantakyselyiden tulosten rajaaminen ja järjestäminen"}}},{"node":{"id":"0ea05616-b6f5-54e2-8045-4a86c7c0b197","frontmatter":{"path":"/osa-3/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"8eff6b69-a4e1-5bfb-8d86-f93e7eef7978","frontmatter":{"path":"/osa-3","title":"Osa 3"}}},{"node":{"id":"22ccbbfe-8a60-5d30-a898-e2da567da345","frontmatter":{"path":"/osa-4/1-mediatyyppi-ja-tiedostojen-kasittely","title":"Mediatyyppi ja tiedostojen käsittely"}}},{"node":{"id":"cfcd1e2d-d678-502f-bc30-5ce24a9a29cd","frontmatter":{"path":"/osa-4/2-ohjelmistokehitysprosessi","title":"Muutama sana ohjelmistokehityksestä"}}},{"node":{"id":"2159f129-bc50-5474-97a7-e67d45a13742","frontmatter":{"path":"/osa-4/3-sovelluksen-rakenne","title":"Sovelluksen rakenne"}}},{"node":{"id":"382343a9-8806-5fc7-8c06-2cc69689b180","frontmatter":{"path":"/osa-4/4-konfiguraatioprofiilit","title":"Konfiguraatioprofiilit"}}},{"node":{"id":"708d8201-7107-566a-a74f-4b56444dcd0b","frontmatter":{"path":"/osa-4/5-sovellusten-testaaminen","title":"Sovellusten testaaminen"}}},{"node":{"id":"db8df001-8629-5e13-be04-df87d1afc2b7","frontmatter":{"path":"/osa-4/6-sovelluksen-siirtaminen-pilvipalveluun","title":"Sovelluksen siirtäminen pilvipalveluun"}}},{"node":{"id":"89ca7162-20da-5868-a3eb-5c973045856b","frontmatter":{"path":"/osa-4/7-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"582a5c8b-beca-5122-a87a-f2cb9068d18a","frontmatter":{"path":"/osa-4","title":"Osa 4"}}},{"node":{"id":"67422910-7142-56bb-80a6-cbd73f7461d3","frontmatter":{"path":"/osa-5/1-http-protokollan-tilattomuus-ja-evasteet","title":"HTTP-protokollan tilattomuus ja evästeet"}}},{"node":{"id":"0428fec4-6ca3-527b-855a-bb3397e65d8c","frontmatter":{"path":"/osa-5/3-nakymatason-ja-metoditason-autorisointi","title":"Näkymä- ja metoditason autorisointi"}}},{"node":{"id":"dd6b12f5-d1ee-54b2-af79-f6f6963f8336","frontmatter":{"path":"/osa-5/4-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"62ff299a-8fe5-58fc-a1f3-010a9ca8ff9d","frontmatter":{"path":"/osa-5","title":"Osa 5"}}},{"node":{"id":"e2bfad01-9334-5cdb-88d1-6509e74db429","frontmatter":{"path":"/osa-6/1-toistuvat-rakenteet-html-sivuilla","title":"Toistuvat rakenteet HTML-sivuilla"}}},{"node":{"id":"59b114a1-6e99-515f-861c-c344839f5f6b","frontmatter":{"path":"/osa-6/2-tyylitiedostot-ja-asettelu","title":"Tyylitiedostot ja sivun asettelun määrittely"}}},{"node":{"id":"3d0269f8-2809-565c-9284-f15ab30559a1","frontmatter":{"path":"/osa-6/3-syotteiden-validointi","title":"Syötteiden validointi"}}},{"node":{"id":"6c0caa0b-e5f4-5818-b2d0-602f51175ffe","frontmatter":{"path":"/osa-6/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"87285c75-6058-5ed6-af3a-67835f2e9758","frontmatter":{"path":"/osa-6","title":"Osa 6"}}},{"node":{"id":"65746c76-9e0b-5c1e-8388-589c3d895db8","frontmatter":{"path":"/osa-6/4-rajapinnat-ja-rest","title":"Rajapinnat ja REST"}}},{"node":{"id":"457aeff4-3970-5308-88c0-cbadc4c4da14","frontmatter":{"path":"/osa-7/3-sovellusten-skaalautuminen","title":"Isommille käyttäjämäärille skaalautuvat sovellukset"}}},{"node":{"id":"40649dd6-c843-59b5-b08b-2ffe5344119c","frontmatter":{"path":"/osa-7/4-reaktiivinen-ohjelmointi","title":"Reaktiivinen ohjelmointi"}}},{"node":{"id":"a1a0b842-6a0f-5dc5-835a-7b47ef681fe4","frontmatter":{"path":"/osa-7/5-yhteenveto","title":"Yhteenveto"}}},{"node":{"id":"a7e70d0e-5b2d-52f5-a5e8-5b9e6fd90aa8","frontmatter":{"path":"/osa-7","title":"Osa 7"}}},{"node":{"id":"c65c7fed-73a9-537f-b5f1-3241761326e3","frontmatter":{"path":"/osa-5/2-autentikaatio-ja-autorisaatio","title":"Autentikaatio ja autorisaatio"}}},{"node":{"id":"7c1c61e3-b3e5-5b18-88ab-571ea9f529b8","frontmatter":{"path":"/osa-7/2-tietoturva","title":"Muutama sana tietoturvasta"}}},{"node":{"id":"8d82aaf9-de05-5ae7-a886-7e21e8781ae3","frontmatter":{"path":"/osa-x/x-johdanto","title":"Johdanto"}}},{"node":{"id":"1edfd6c7-3880-5e94-b639-6c9d80ff7d14","frontmatter":{"path":"/osa-7/1-selainohjelmistot-ja-javascript","title":"Selainohjelmistot ja JavaScript"}}}]}},"pageContext":{}},"staticQueryHashes":["2929037737","994120085"]}